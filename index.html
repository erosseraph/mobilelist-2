<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>定制你的专属歌厅 v2.2.0</title>
    
    <!-- PWA 配置 -->
    <meta name="theme-color" content="#1a2a6c">
    <meta name="description" content="专业歌厅定制服务，打造您的专属音乐空间">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="歌厅定制">

    <!-- 添加SheetJS库用于Excel导出 -->
    <script src="https://cdn.sheetjs.com/xlsx-0.20.0/package/dist/xlsx.full.min.js"></script>
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-analytics-compat.js"></script>
    
    <style>
        /* ==================== 重置和基础样式 ==================== */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Microsoft YaHei', 'Segoe UI', sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #1a2a6c, #b21f1f, #fdbb2d);
            color: white;
            min-height: 100vh;
            padding-bottom: 80px;
            overflow-x: hidden;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 20px;
        }
        
        /* ==================== 导航栏样式 ==================== */
        .navbar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 0;
            margin-bottom: 25px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .logo {
            font-size: 1.8rem;
            font-weight: bold;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .logo .version {
            font-size: 0.8rem;
            background: rgba(255, 255, 255, 0.2);
            padding: 2px 8px;
            border-radius: 10px;
            margin-left: 5px;
        }
        
        .nav-buttons {
            display: flex;
            gap: 12px;
            align-items: center;
        }
        
        .nav-btn {
            background: rgba(255, 255, 255, 0.1);
            border: none;
            color: white;
            padding: 12px 24px;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s;
            backdrop-filter: blur(10px);
            font-size: 1rem;
            display: flex;
            align-items: center;
            gap: 8px;
            min-height: 48px;
            justify-content: center;
        }
        
        .nav-btn:hover, .nav-btn.active {
            background: rgba(255, 255, 255, 0.2);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }
        
        .user-section {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .login-btn {
            background: rgba(255, 255, 255, 0.2);
            border: none;
            color: white;
            padding: 10px 20px;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 0.95rem;
            min-height: 44px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .login-btn:hover {
            background: rgba(255, 255, 255, 0.3);
        }
        
        .user-info {
            display: none;
            align-items: center;
            gap: 12px;
            background: rgba(255, 255, 255, 0.1);
            padding: 8px 16px;
            border-radius: 25px;
            backdrop-filter: blur(10px);
        }
        
        .user-avatar {
            width: 36px;
            height: 36px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 1.1rem;
        }
        
        .logout-btn {
            background: rgba(255, 255, 255, 0.1);
            border: none;
            color: white;
            padding: 6px 12px;
            border-radius: 15px;
            cursor: pointer;
            font-size: 0.85rem;
            transition: all 0.3s;
        }
        
        .logout-btn:hover {
            background: rgba(255, 255, 255, 0.2);
        }
        
        /* ==================== 页面容器 ==================== */
        .page-container {
            min-height: 600px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 20px;
            padding: 20px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        /* ==================== 点歌系统页面 ==================== */
        #karaoke-page {
            display: flex;
            gap: 25px;
            flex-wrap: wrap;
        }
        
        /* 桌面端：左右并排 */
        @media (min-width: 768px) {
            #karaoke-page {
                flex-direction: row;
            }
            
            .songs-section {
                flex: 2;
            }
            
            .playlist-section {
                flex: 1;
            }
        }
        
        /* 移动端：选项卡切换 */
        @media (max-width: 767px) {
            #karaoke-page {
                flex-direction: column;
            }
            
            .karaoke-tab-buttons {
                display: flex;
                margin-bottom: 20px;
                border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            }
            
            .karaoke-tab-btn {
                flex: 1;
                padding: 15px;
                background: none;
                border: none;
                color: white;
                cursor: pointer;
                font-size: 1rem;
                display: flex;
                align-items: center;
                justify-content: center;
                gap: 10px;
                border-bottom: 3px solid transparent;
            }
            
            .karaoke-tab-btn.active {
                border-bottom-color: #667eea;
                background: rgba(102, 126, 234, 0.1);
            }
            
            .karaoke-tab-content {
                display: none;
            }
            
            .karaoke-tab-content.active {
                display: block;
            }
        }
        
        .songs-section, .playlist-section {
            background: rgba(255, 255, 255, 0.08);
            border-radius: 15px;
            padding: 25px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .playlist-section {
            display: flex;
            flex-direction: column;
            max-height: 700px;
        }
        
        /* 排行榜样式 */
        .charts-container {
            display: flex;
            gap: 10px;
            margin-bottom: 25px;
            flex-wrap: wrap;
        }
        
        .chart-category {
            background: rgba(255, 255, 255, 0.1);
            padding: 10px 18px;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s;
            border: 1px solid transparent;
            font-size: 0.95rem;
            white-space: nowrap;
        }
        
        .chart-category:hover, .chart-category.active {
            background: rgba(255, 255, 255, 0.2);
            border-color: rgba(255, 255, 255, 0.3);
            transform: translateY(-2px);
        }
        
        /* 歌手列表样式 */
        .artists-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 25px;
        }
        
        @media (max-width: 767px) {
            .artists-container {
                grid-template-columns: 1fr;
            }
        }
        
        .artist-category {
            background: rgba(255, 255, 255, 0.08);
            border-radius: 15px;
            padding: 20px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .artist-category h4 {
            margin-bottom: 15px;
            font-size: 1.2rem;
            color: #a0e7ff;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .artists-list {
            max-height: 300px;
            overflow-y: auto;
            padding-right: 10px;
        }
        
        .artist-item {
            padding: 10px 15px;
            margin-bottom: 8px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
            border: 1px solid transparent;
        }
        
        .artist-item:hover {
            background: rgba(255, 255, 255, 0.1);
            border-color: rgba(255, 255, 255, 0.2);
            transform: translateX(5px);
        }
        
        /* 搜索框样式 */
        .search-container {
            display: flex;
            gap: 12px;
            margin-bottom: 25px;
            flex-wrap: wrap;
        }
        
        .search-input {
            flex: 1;
            min-width: 200px;
            padding: 14px 20px;
            border: none;
            border-radius: 25px;
            background: rgba(255, 255, 255, 0.1);
            color: white;
            font-size: 1rem;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .search-input::placeholder {
            color: rgba(255, 255, 255, 0.7);
        }
        
        .search-btn, .clear-btn {
            background: rgba(255, 255, 255, 0.2);
            border: none;
            color: white;
            padding: 14px 24px;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 1rem;
            min-width: 100px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        
        .search-btn:hover, .clear-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translateY(-2px);
        }
        
        /* 歌曲列表样式 */
        .songs-container {
            max-height: 400px;
            overflow-y: auto;
            margin-bottom: 20px;
            border-radius: 10px;
            padding-right: 5px;
        }
        
        /* 滚动条样式 */
        .songs-container::-webkit-scrollbar,
        .playlist-items::-webkit-scrollbar,
        .orders-table-container::-webkit-scrollbar,
        .my-orders-container::-webkit-scrollbar,
        .artists-list::-webkit-scrollbar {
            width: 8px;
        }
        
        .songs-container::-webkit-scrollbar-track,
        .playlist-items::-webkit-scrollbar-track,
        .orders-table-container::-webkit-scrollbar-track,
        .my-orders-container::-webkit-scrollbar-track,
        .artists-list::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 4px;
        }
        
        .songs-container::-webkit-scrollbar-thumb,
        .playlist-items::-webkit-scrollbar-thumb,
        .orders-table-container::-webkit-scrollbar-thumb,
        .my-orders-container::-webkit-scrollbar-thumb,
        .artists-list::-webkit-scrollbar-thumb {
            background: rgba(255, 255, 255, 0.3);
            border-radius: 4px;
        }
        
        .songs-container::-webkit-scrollbar-thumb:hover,
        .playlist-items::-webkit-scrollbar-thumb:hover,
        .orders-table-container::-webkit-scrollbar-thumb:hover,
        .my-orders-container::-webkit-scrollbar-thumb:hover,
        .artists-list::-webkit-scrollbar-thumb:hover {
            background: rgba(255, 255, 255, 0.4);
        }
        
        .song {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 18px;
            margin-bottom: 10px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            transition: all 0.3s;
            border: 1px solid transparent;
        }
        
        .song:hover {
            background: rgba(255, 255, 255, 0.1);
            transform: translateX(5px);
            border-color: rgba(255, 255, 255, 0.1);
        }
        
        .song-info {
            flex: 1;
            min-width: 0;
            margin-right: 15px;
        }
        
        .song-title {
            font-weight: bold;
            margin-bottom: 6px;
            font-size: 1.05rem;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        .song-artist {
            font-size: 0.9rem;
            opacity: 0.8;
            margin-bottom: 4px;
        }
        
        .song-album {
            font-size: 0.85rem;
            opacity: 0.6;
            font-style: italic;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        .song-controls {
            display: flex;
            gap: 10px;
            flex-shrink: 0;
        }
        
        .preview-btn, .add-btn {
            background: rgba(255, 255, 255, 0.1);
            border: none;
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 6px;
            min-width: 80px;
            justify-content: center;
        }
        
        .preview-btn:hover, .add-btn:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: translateY(-2px);
        }
        
        .preview-btn.playing {
            background: rgba(46, 204, 113, 0.3);
        }
        
        .load-more-btn {
            background: rgba(255, 255, 255, 0.15);
            border: none;
            color: white;
            padding: 15px 30px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 1rem;
            transition: all 0.3s;
            width: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            margin-top: 20px;
        }
        
        .load-more-btn:hover {
            background: rgba(255, 255, 255, 0.25);
            transform: translateY(-2px);
        }
        
        .load-more-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }
        
        /* 歌单样式 */
        .playlist-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .playlist-count {
            font-size: 1.2rem;
            font-weight: bold;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .playlist-count-number {
            background: rgba(255, 255, 255, 0.2);
            padding: 4px 12px;
            border-radius: 15px;
            font-size: 1rem;
        }
        
        .submit-playlist-btn {
            background: linear-gradient(135deg, #667eea, #764ba2);
            border: none;
            color: white;
            padding: 12px 24px;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 1rem;
            display: flex;
            align-items: center;
            gap: 8px;
            font-weight: bold;
        }
        
        .submit-playlist-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }
        
        .submit-playlist-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        
        .playlist-items {
            flex: 1;
            min-height: 200px;
            max-height: 450px;
            overflow-y: auto;
            margin-bottom: 20px;
        }
        
        .playlist-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 15px;
            margin-bottom: 8px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
            transition: all 0.3s;
            border: 1px solid transparent;
        }
        
        .playlist-item:hover {
            background: rgba(255, 255, 255, 0.1);
            border-color: rgba(255, 255, 255, 0.1);
        }
        
        .playlist-item-content {
            display: flex;
            align-items: center;
            gap: 15px;
            flex: 1;
            min-width: 0;
        }
        
        .song-number {
            width: 28px;
            height: 28px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 50%;
            text-align: center;
            line-height: 28px;
            font-weight: bold;
            font-size: 0.9rem;
            flex-shrink: 0;
        }
        
        .playlist-item-info {
            flex: 1;
            min-width: 0;
        }
        
        .playlist-item-title {
            font-weight: bold;
            margin-bottom: 4px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        .playlist-item-artist {
            font-size: 0.85rem;
            opacity: 0.8;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        .remove-btn {
            background: rgba(255, 59, 48, 0.3);
            border: none;
            color: white;
            width: 28px;
            height: 28px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            transition: all 0.3s;
            flex-shrink: 0;
        }
        
        .remove-btn:hover {
            background: rgba(255, 59, 48, 0.5);
            transform: scale(1.1);
        }
        
        .empty-playlist {
            text-align: center;
            padding: 60px 20px;
            opacity: 0.7;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 15px;
        }
        
        .empty-playlist-icon {
            font-size: 3rem;
            opacity: 0.5;
        }
        
        /* 价格推荐卡片 */
        .price-recommendation {
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.2), rgba(118, 75, 162, 0.2));
            border-radius: 15px;
            padding: 20px;
            margin-top: 20px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .price-recommendation h4 {
            margin-bottom: 15px;
            font-size: 1.2rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .recommended-plan {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 15px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .plan-name {
            font-weight: bold;
            font-size: 1.1rem;
        }
        
        .plan-price {
            font-size: 1.3rem;
            font-weight: bold;
            color: #ffd700;
        }
        
        .shipping-cost {
            display: flex;
            justify-content: space-between;
            margin-bottom: 15px;
            font-size: 1rem;
        }
        
        .total-price {
            display: flex;
            justify-content: space-between;
            font-size: 1.4rem;
            font-weight: bold;
            padding-top: 15px;
            border-top: 1px solid rgba(255, 255, 255, 0.2);
            color: #2ecc71;
        }
        
        /* ==================== 价格配套页面 ==================== */
        #pricing-page {
            display: none;
        }
        
        .pricing-header {
            text-align: center;
            margin-bottom: 30px;
        }
        
        .pricing-header h2 {
            font-size: 2rem;
            margin-bottom: 10px;
            background: linear-gradient(135deg, #fff, #ffd700);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .pricing-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 25px;
            padding: 20px 0;
        }
        
        .pricing-card {
            background: rgba(255, 255, 255, 0.08);
            border-radius: 20px;
            padding: 30px;
            text-align: center;
            transition: all 0.4s;
            position: relative;
            border: 1px solid rgba(255, 255, 255, 0.1);
            display: flex;
            flex-direction: column;
            height: 100%;
        }
        
        .pricing-card:hover {
            transform: translateY(-10px);
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.3);
            border-color: rgba(255, 255, 255, 0.2);
        }
        
        .pricing-card.popular {
            border: 2px solid #ffd700;
            background: rgba(255, 255, 255, 0.12);
        }
        
        .popular-badge {
            position: absolute;
            top: -15px;
            left: 50%;
            transform: translateX(-50%);
            background: linear-gradient(135deg, #ffd700, #ffaa00);
            color: #333;
            padding: 8px 20px;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: bold;
            box-shadow: 0 5px 15px rgba(255, 215, 0, 0.3);
        }
        
        .plan-name {
            font-size: 1.6rem;
            font-weight: bold;
            margin-bottom: 15px;
            background: linear-gradient(135deg, #fff, #a0e7ff);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .price {
            font-size: 2.5rem;
            font-weight: bold;
            margin-bottom: 20px;
            color: #ffd700;
        }
        
        .song-range {
            color: rgba(255, 255, 255, 0.9);
            margin-bottom: 25px;
            font-size: 1.1rem;
            padding: 10px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
        }
        
        .select-btn {
            background: linear-gradient(135deg, #667eea, #764ba2);
            border: none;
            color: white;
            padding: 16px 30px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 1.1rem;
            transition: all 0.3s;
            width: 100%;
            margin-top: auto;
            font-weight: bold;
            letter-spacing: 1px;
        }
        
        .select-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 20px rgba(102, 126, 234, 0.4);
        }
        
        /* 配送信息样式 */
        .shipping-info {
            background: rgba(255, 255, 255, 0.08);
            border-radius: 20px;
            padding: 30px;
            margin: 40px auto;
            max-width: 900px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .shipping-info h3 {
            text-align: center;
            margin: 0 0 30px 0;
            font-size: 1.8rem;
            background: linear-gradient(135deg, #fff, #a0e7ff);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .shipping-options {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 25px;
            margin-bottom: 25px;
        }
        
        @media (max-width: 768px) {
            .shipping-options {
                grid-template-columns: 1fr;
            }
        }
        
        .shipping-option {
            background: rgba(255, 255, 255, 0.05);
            padding: 25px;
            border-radius: 15px;
            transition: all 0.3s;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .shipping-option:hover {
            background: rgba(255, 255, 255, 0.1);
            transform: translateY(-5px);
        }
        
        .shipping-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .shipping-region {
            font-weight: bold;
            font-size: 1.3rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .shipping-price {
            background: linear-gradient(135deg, #667eea, #764ba2);
            padding: 8px 16px;
            border-radius: 20px;
            font-weight: bold;
            font-size: 1.2rem;
        }
        
        .shipping-desc {
            font-size: 1rem;
            opacity: 0.9;
            line-height: 1.6;
        }
        
        .shipping-note {
            text-align: center;
            font-size: 0.9rem;
            opacity: 0.7;
            font-style: italic;
            margin-top: 20px;
            padding-top: 20px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        /* ==================== 我的订单页面 ==================== */
        #my-orders-page {
            display: none;
        }
        
        .my-orders-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            flex-wrap: wrap;
            gap: 20px;
        }
        
        .my-orders-header h2 {
            font-size: 2rem;
            background: linear-gradient(135deg, #fff, #a0e7ff);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .my-orders-controls {
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
        }
        
        .export-btn, .refresh-btn, .filter-btn, .batch-btn, .my-orders-btn {
            background: rgba(255, 255, 255, 0.1);
            border: none;
            color: white;
            padding: 12px 24px;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 1rem;
            display: flex;
            align-items: center;
            gap: 8px;
            min-height: 48px;
        }
        
        .export-btn {
            background: linear-gradient(135deg, #2ecc71, #27ae60);
        }
        
        .refresh-btn {
            background: linear-gradient(135deg, #3498db, #2980b9);
        }
        
        .filter-btn {
            background: linear-gradient(135deg, #9b59b6, #8e44ad);
        }
        
        .batch-btn {
            background: linear-gradient(135deg, #e74c3c, #c0392b);
        }
        
        .my-orders-btn {
            background: linear-gradient(135deg, #9b59b6, #8e44ad);
        }
        
        .export-btn:hover, .refresh-btn:hover, .filter-btn:hover, .batch-btn:hover, .my-orders-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }
        
        /* 分页系统样式 */
        .pagination-container {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 10px;
            margin: 20px 0;
            padding: 15px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            flex-wrap: wrap;
        }
        
        .pagination-btn {
            background: rgba(255, 255, 255, 0.1);
            border: none;
            color: white;
            padding: 10px 18px;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 0.95rem;
            min-width: 40px;
            text-align: center;
        }
        
        .pagination-btn:hover:not(:disabled) {
            background: rgba(255, 255, 255, 0.2);
            transform: translateY(-2px);
        }
        
        .pagination-btn.active {
            background: linear-gradient(135deg, #667eea, #764ba2);
            font-weight: bold;
        }
        
        .pagination-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .page-info {
            font-size: 0.95rem;
            opacity: 0.8;
            margin-left: 15px;
        }
        
        /* 过滤面板 */
        .filter-panel {
            background: rgba(255, 255, 255, 0.08);
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 30px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            display: none;
        }
        
        .filter-panel.show {
            display: block;
            animation: slideDown 0.3s ease;
        }
        
        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .filter-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .filter-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        
        .filter-label {
            font-weight: bold;
            font-size: 0.95rem;
            opacity: 0.9;
        }
        
        .filter-select, .filter-input, .filter-date {
            padding: 12px 15px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 10px;
            background: rgba(255, 255, 255, 0.1);
            color: white;
            font-size: 1rem;
        }
        
        .filter-select:focus, .filter-input:focus, .filter-date:focus {
            outline: none;
            border-color: rgba(255, 255, 255, 0.4);
            box-shadow: 0 0 0 2px rgba(255, 255, 255, 0.1);
        }
        
        .filter-actions {
            display: flex;
            justify-content: flex-end;
            gap: 12px;
            margin-top: 20px;
        }
        
        .apply-filter-btn, .clear-filter-btn {
            padding: 12px 24px;
            border-radius: 25px;
            border: none;
            cursor: pointer;
            font-size: 1rem;
            transition: all 0.3s;
            min-width: 120px;
        }
        
        .apply-filter-btn {
            background: linear-gradient(135deg, #2ecc71, #27ae60);
            color: white;
        }
        
        .clear-filter-btn {
            background: rgba(255, 255, 255, 0.1);
            color: white;
        }
        
        .apply-filter-btn:hover, .clear-filter-btn:hover {
            transform: translateY(-2px);
        }
        
        /* 统计卡片 */
        .stats-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .stat-card {
            background: rgba(255, 255, 255, 0.08);
            border-radius: 15px;
            padding: 25px;
            text-align: center;
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: all 0.3s;
        }
        
        .stat-card:hover {
            transform: translateY(-5px);
            background: rgba(255, 255, 255, 0.12);
        }
        
        .stat-card-icon {
            font-size: 2.5rem;
            margin-bottom: 15px;
            opacity: 0.9;
        }
        
        .stat-card-value {
            font-size: 2.2rem;
            font-weight: bold;
            margin-bottom: 10px;
            background: linear-gradient(135deg, #fff, #a0e7ff);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .stat-card-label {
            font-size: 0.95rem;
            opacity: 0.8;
        }
        
        /* 订单表格 */
        .orders-table-container, .my-orders-container {
            overflow-x: auto;
            border-radius: 15px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            background: rgba(255, 255, 255, 0.05);
            margin-bottom: 20px;
        }
        
        .orders-table, .my-orders-table {
            width: 100%;
            border-collapse: collapse;
            min-width: 1200px;
        }
        
        .orders-table th, .my-orders-table th {
            background: rgba(255, 255, 255, 0.1);
            padding: 18px 20px;
            text-align: left;
            font-weight: bold;
            font-size: 0.95rem;
            position: sticky;
            top: 0;
            z-index: 10;
            border-bottom: 2px solid rgba(255, 255, 255, 0.2);
        }
        
        .orders-table td, .my-orders-table td {
            padding: 16px 20px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            vertical-align: middle;
        }
        
        .orders-table tr, .my-orders-table tr {
            transition: all 0.3s;
        }
        
        .orders-table tr:hover, .my-orders-table tr:hover {
            background: rgba(255, 255, 255, 0.05);
        }
        
        .orders-table tr.selected, .my-orders-table tr.selected {
            background: rgba(52, 152, 219, 0.15);
        }
        
        .select-checkbox {
            width: 40px;
            text-align: center;
        }
        
        .select-checkbox input[type="checkbox"] {
            width: 18px;
            height: 18px;
            cursor: pointer;
        }
        
        .status-badge {
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: bold;
            display: inline-flex;
            align-items: center;
            gap: 6px;
            white-space: nowrap;
        }
        
        .status-pending {
            background: rgba(241, 196, 15, 0.2);
            color: #f1c40f;
            border: 1px solid rgba(241, 196, 15, 0.3);
        }
        
        .status-paid {
            background: rgba(46, 204, 113, 0.2);
            color: #2ecc71;
            border: 1px solid rgba(46, 204, 113, 0.3);
        }
        
        .status-shipped {
            background: rgba(52, 152, 219, 0.2);
            color: #3498db;
            border: 1px solid rgba(52, 152, 219, 0.3);
        }
        
        .status-completed {
            background: rgba(39, 174, 96, 0.2);
            color: #27ae60;
            border: 1px solid rgba(39, 174, 96, 0.3);
        }
        
        .status-cancelled {
            background: rgba(231, 76, 60, 0.2);
            color: #e74c3c;
            border: 1px solid rgba(231, 76, 60, 0.3);
        }
        
        .status-deleted {
            background: rgba(149, 165, 166, 0.2);
            color: #95a5a6;
            border: 1px solid rgba(149, 165, 166, 0.3);
        }
        
        .action-buttons {
            display: flex;
            gap: 8px;
        }
        
        .action-btn {
            padding: 8px 12px;
            border-radius: 15px;
            border: none;
            cursor: pointer;
            font-size: 0.85rem;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 5px;
            min-width: 80px;
            justify-content: center;
        }
        
        .view-btn {
            background: rgba(52, 152, 219, 0.2);
            color: #3498db;
            border: 1px solid rgba(52, 152, 219, 0.3);
        }
        
        .edit-btn {
            background: rgba(155, 89, 182, 0.2);
            color: #9b59b6;
            border: 1px solid rgba(155, 89, 182, 0.3);
        }
        
        .delete-btn {
            background: rgba(231, 76, 60, 0.2);
            color: #e74c3c;
            border: 1px solid rgba(231, 76, 60, 0.3);
        }
        
        .view-btn:hover {
            background: rgba(52, 152, 219, 0.3);
            transform: translateY(-2px);
        }
        
        .edit-btn:hover {
            background: rgba(155, 89, 182, 0.3);
            transform: translateY(-2px);
        }
        
        .delete-btn:hover {
            background: rgba(231, 76, 60, 0.3);
            transform: translateY(-2px);
        }
        
        /* 批量操作面板 */
        .batch-panel {
            background: rgba(255, 255, 255, 0.08);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 25px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            display: none;
            animation: slideDown 0.3s ease;
        }
        
        .batch-panel.show {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 15px;
        }
        
        .batch-info {
            display: flex;
            align-items: center;
            gap: 15px;
            font-size: 1.1rem;
        }
        
        .batch-selected-count {
            background: rgba(52, 152, 219, 0.3);
            padding: 8px 16px;
            border-radius: 20px;
            font-weight: bold;
        }
        
        .batch-actions {
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
        }
        
        .batch-action-btn {
            padding: 10px 20px;
            border-radius: 20px;
            border: none;
            cursor: pointer;
            font-size: 0.95rem;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 8px;
            min-width: 120px;
            justify-content: center;
        }
        
        .batch-export-btn {
            background: linear-gradient(135deg, #2ecc71, #27ae60);
            color: white;
        }
        
        .batch-status-btn {
            background: linear-gradient(135deg, #3498db, #2980b9);
            color: white;
        }
        
        .batch-delete-btn {
            background: linear-gradient(135deg, #e74c3c, #c0392b);
            color: white;
        }
        
        .batch-clear-btn {
            background: rgba(255, 255, 255, 0.1);
            color: white;
        }
        
        .batch-action-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }
        
        /* ==================== 模态框样式 ==================== */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.85);
            z-index: 3000;
            justify-content: center;
            align-items: center;
            animation: fadeIn 0.3s ease;
            padding: 20px;
            overflow-y: auto;
        }
        
        @keyframes fadeIn {
            from {
                opacity: 0;
            }
            to {
                opacity: 1;
            }
        }
        
        .modal-content {
            background: linear-gradient(135deg, #1a2a6c, #b21f1f);
            border-radius: 20px;
            padding: 35px;
            width: 100%;
            max-width: 600px;
            max-height: 90vh;
            overflow-y: auto;
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 20px 50px rgba(0, 0, 0, 0.5);
            animation: slideUp 0.4s ease;
        }
        
        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(50px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .modal-title {
            font-size: 1.8rem;
            font-weight: bold;
            background: linear-gradient(135deg, #fff, #ffd700);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .close-btn {
            background: none;
            border: none;
            color: white;
            font-size: 2rem;
            cursor: pointer;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: all 0.3s;
        }
        
        .close-btn:hover {
            background: rgba(255, 255, 255, 0.1);
            transform: rotate(90deg);
        }
        
        .login-methods {
            display: flex;
            flex-direction: column;
            gap: 18px;
            margin-bottom: 25px;
        }
        
        .login-method-btn {
            background: rgba(255, 255, 255, 0.1);
            border: none;
            color: white;
            padding: 18px;
            border-radius: 12px;
            cursor: pointer;
            font-size: 1.1rem;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .login-method-btn:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: translateY(-3px);
        }
        
        .login-method-icon {
            font-size: 1.3rem;
        }
        
        /* 表单样式 */
        .form-container {
            max-width: 500px;
            margin: 0 auto;
        }
        
        .form-group {
            margin-bottom: 25px;
        }
        
        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 25px;
        }
        
        @media (max-width: 600px) {
            .form-row {
                grid-template-columns: 1fr;
            }
        }
        
        .form-label {
            display: block;
            margin-bottom: 10px;
            font-weight: bold;
            font-size: 1.05rem;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .form-label .required {
            color: #ff6b6b;
            font-size: 1.2rem;
        }
        
        .form-input, .form-select, .form-textarea {
            width: 100%;
            padding: 15px;
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 12px;
            background: rgba(255, 255, 255, 0.1);
            color: white;
            font-size: 1rem;
            transition: all 0.3s;
        }
        
        .form-input:focus, .form-select:focus, .form-textarea:focus {
            outline: none;
            border-color: rgba(255, 255, 255, 0.5);
            box-shadow: 0 0 0 3px rgba(255, 255, 255, 0.1);
            background: rgba(255, 255, 255, 0.15);
        }
        
        .form-textarea {
            min-height: 120px;
            resize: vertical;
        }
        
        .form-input::placeholder, .form-textarea::placeholder {
            color: rgba(255, 255, 255, 0.6);
        }
        
        .form-input.error, .form-select.error, .form-textarea.error {
            border-color: #ff6b6b;
            background: rgba(255, 107, 107, 0.1);
        }
        
        .error-message {
            color: #ff6b6b;
            font-size: 0.9rem;
            margin-top: 8px;
            display: flex;
            align-items: center;
            gap: 6px;
            animation: fadeIn 0.3s ease;
        }
        
        .form-radio-group {
            display: flex;
            gap: 25px;
            margin-top: 10px;
        }
        
        .form-radio-label {
            display: flex;
            align-items: center;
            gap: 10px;
            cursor: pointer;
            padding: 12px 20px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            transition: all 0.3s;
            flex: 1;
            justify-content: center;
        }
        
        .form-radio-label:hover {
            background: rgba(255, 255, 255, 0.15);
        }
        
        .form-radio-label.selected {
            background: rgba(52, 152, 219, 0.3);
            border: 1px solid rgba(52, 152, 219, 0.5);
        }
        
        .form-radio-label input[type="radio"] {
            margin: 0;
            width: 18px;
            height: 18px;
        }
        
        .form-submit-btn {
            background: linear-gradient(135deg, #667eea, #764ba2);
            border: none;
            color: white;
            padding: 18px 30px;
            border-radius: 12px;
            cursor: pointer;
            font-size: 1.1rem;
            width: 100%;
            transition: all 0.3s;
            font-weight: bold;
            letter-spacing: 1px;
            margin-top: 20px;
        }
        
        .form-submit-btn:hover:not(:disabled) {
            transform: translateY(-3px);
            box-shadow: 0 10px 20px rgba(102, 126, 234, 0.4);
        }
        
        .form-submit-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .form-info {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 25px;
            border-left: 4px solid #3498db;
        }
        
        .form-info h4 {
            margin-bottom: 10px;
            font-size: 1.2rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .form-info-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 15px;
        }
        
        .song-count-info {
            font-size: 1.1rem;
        }
        
        .song-count-number {
            background: rgba(52, 152, 219, 0.3);
            padding: 6px 12px;
            border-radius: 15px;
            font-weight: bold;
            margin-left: 5px;
        }
        
        .price-summary {
            text-align: right;
        }
        
        .base-price, .shipping-fee, .total-price-summary {
            margin-bottom: 8px;
            font-size: 1rem;
        }
        
        .total-price-summary {
            font-size: 1.3rem;
            font-weight: bold;
            color: #2ecc71;
            margin-top: 10px;
            padding-top: 10px;
            border-top: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        /* 订单详情样式 */
        .order-details-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 25px;
        }
        
        .detail-card {
            background: rgba(255, 255, 255, 0.08);
            border-radius: 12px;
            padding: 20px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .detail-card h4 {
            margin-bottom: 15px;
            font-size: 1.1rem;
            color: #a0e7ff;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .detail-item {
            margin-bottom: 12px;
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
        }
        
        .detail-label {
            font-weight: bold;
            opacity: 0.8;
            min-width: 100px;
        }
        
        .detail-value {
            text-align: right;
            flex: 1;
            word-break: break-word;
        }
        
        .songs-list-container {
            max-height: 300px;
            overflow-y: auto;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
            padding: 15px;
            margin-top: 10px;
        }
        
        .song-detail-item {
            padding: 12px 15px;
            margin-bottom: 10px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
            border-left: 3px solid #3498db;
        }
        
        .song-detail-title {
            font-weight: bold;
            margin-bottom: 5px;
            font-size: 1.05rem;
        }
        
        .song-detail-artist {
            opacity: 0.8;
            font-size: 0.9rem;
        }
        
        .song-detail-album {
            opacity: 0.6;
            font-size: 0.85rem;
            font-style: italic;
            margin-top: 3px;
        }
        
        .order-actions {
            display: flex;
            gap: 12px;
            margin-top: 25px;
            flex-wrap: wrap;
        }
        
        .status-update-form {
            background: rgba(255, 255, 255, 0.08);
            border-radius: 12px;
            padding: 20px;
            margin-top: 25px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .status-update-row {
            display: flex;
            gap: 15px;
            align-items: center;
            flex-wrap: wrap;
        }
        
        .status-select {
            flex: 1;
            min-width: 200px;
        }
        
        .status-update-btn {
            background: linear-gradient(135deg, #2ecc71, #27ae60);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 1rem;
            transition: all 0.3s;
        }
        
        .status-update-btn:hover {
            transform: translateY(-2px);
        }
        
        /* 批量状态更新模态框 */
        .batch-status-form {
            background: rgba(255, 255, 255, 0.08);
            border-radius: 12px;
            padding: 20px;
            margin-top: 20px;
        }
        
        .selected-orders-list {
            max-height: 200px;
            overflow-y: auto;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 20px;
        }
        
        .selected-order-item {
            padding: 10px 15px;
            margin-bottom: 8px;
            background: rgba(255, 255, 255, 0.08);
            border-radius: 8px;
            border-left: 3px solid #3498db;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        /* ==================== 工具类 ==================== */
        .hidden {
            display: none !important;
        }
        
        .loading {
            text-align: center;
            padding: 60px 20px;
            opacity: 0.8;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 20px;
        }
        
        .loading-spinner {
            width: 50px;
            height: 50px;
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: white;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }
        
        .error {
            text-align: center;
            padding: 60px 20px;
            opacity: 0.8;
            color: #ff6b6b;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 15px;
        }
        
        .error-icon {
            font-size: 3rem;
            opacity: 0.7;
        }
        
        .success {
            text-align: center;
            padding: 60px 20px;
            opacity: 0.8;
            color: #2ecc71;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 15px;
        }
        
        .success-icon {
            font-size: 3rem;
            opacity: 0.7;
        }
        
        .empty-state {
            text-align: center;
            padding: 80px 20px;
            opacity: 0.6;
        }
        
        .empty-state-icon {
            font-size: 4rem;
            margin-bottom: 20px;
            opacity: 0.5;
        }
        
        .empty-state-message {
            font-size: 1.2rem;
            margin-bottom: 15px;
        }
        
        .empty-state-submessage {
            opacity: 0.7;
        }
        
        /* 消息通知 */
        .message-notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 25px;
            border-radius: 10px;
            z-index: 5000;
            transition: all 0.3s;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            max-width: 400px;
            word-break: break-word;
            display: flex;
            align-items: center;
            gap: 10px;
            opacity: 0;
            transform: translateY(-20px);
        }
        
        /* 响应式调整 */
        @media (max-width: 768px) {
            .container {
                padding: 0 15px;
            }
            
            .navbar {
                flex-direction: column;
                gap: 15px;
                padding: 15px 0;
            }
            
            .nav-buttons {
                width: 100%;
                justify-content: center;
                flex-wrap: wrap;
            }
            
            .nav-btn, .login-btn {
                padding: 10px 18px;
                font-size: 0.9rem;
            }
            
            .logo {
                font-size: 1.5rem;
            }
            
            .page-container {
                padding: 15px;
            }
            
            .modal-content {
                padding: 25px;
                max-height: 85vh;
            }
            
            .modal-title {
                font-size: 1.5rem;
            }
            
            .orders-table th, .orders-table td,
            .my-orders-table th, .my-orders-table td {
                padding: 12px 15px;
                font-size: 0.9rem;
            }
            
            .action-buttons {
                flex-direction: column;
                gap: 5px;
            }
            
            .action-btn {
                min-width: 60px;
                padding: 6px 10px;
                font-size: 0.8rem;
            }
            
            .pagination-container {
                flex-direction: column;
                gap: 8px;
            }
        }
        
        @media (max-width: 480px) {
            .container {
                padding: 0 10px;
            }
            
            .nav-btn, .login-btn {
                padding: 8px 15px;
                font-size: 0.85rem;
                min-height: 42px;
            }
            
            .logo {
                font-size: 1.3rem;
            }
            
            .page-container {
                padding: 12px;
            }
            
            .songs-section,
            .playlist-section {
                padding: 20px;
            }
            
            .modal-content {
                padding: 20px;
                max-height: 80vh;
            }
            
            .form-row {
                grid-template-columns: 1fr;
                gap: 15px;
            }
            
            .orders-controls, .my-orders-controls {
                flex-direction: column;
                width: 100%;
            }
            
            .export-btn, .refresh-btn, .filter-btn, .batch-btn, .my-orders-btn {
                width: 100%;
                justify-content: center;
            }
            
            .batch-panel.show {
                flex-direction: column;
                align-items: stretch;
            }
            
            .batch-actions {
                flex-direction: column;
            }
            
            .batch-action-btn {
                width: 100%;
            }
        }
        
        /* 动画效果 */
        .fade-in {
            animation: fadeIn 0.5s ease;
        }
        
        .slide-in-left {
            animation: slideInLeft 0.5s ease;
        }
        
        @keyframes slideInLeft {
            from {
                opacity: 0;
                transform: translateX(-30px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }
        
        .slide-in-right {
            animation: slideInRight 0.5s ease;
        }
        
        @keyframes slideInRight {
            from {
                opacity: 0;
                transform: translateX(30px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }
        
        .pulse {
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0% {
                box-shadow: 0 0 0 0 rgba(52, 152, 219, 0.7);
            }
            70% {
                box-shadow: 0 0 0 10px rgba(52, 152, 219, 0);
            }
            100% {
                box-shadow: 0 0 0 0 rgba(52, 152, 219, 0);
            }
        }
        
        /* 自定义滚动条 */
        *::-webkit-scrollbar {
            width: 10px;
            height: 10px;
        }
        
        *::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 5px;
        }
        
        *::-webkit-scrollbar-thumb {
            background: rgba(255, 255, 255, 0.3);
            border-radius: 5px;
        }
        
        *::-webkit-scrollbar-thumb:hover {
            background: rgba(255, 255, 255, 0.4);
        }
    </style>
</head>
<body>
    <!-- 登录模态框 -->
    <div class="modal" id="login-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">登录 / 注册</h2>
                <button class="close-btn" id="close-login">&times;</button>
            </div>
            
            <div class="login-methods">
                <button class="login-method-btn" id="email-login-btn">
                    <span class="login-method-icon">📧</span>
                    <span>邮箱登录/注册</span>
                </button>
                <button class="login-method-btn" id="google-login-btn">
                    <span class="login-method-icon">🔵</span>
                    <span>Google 登录</span>
                </button>
            </div>
        </div>
    </div>

    <!-- 提交歌单模态框 -->
    <div class="modal" id="submit-playlist-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">提交歌单订单</h2>
                <button class="close-btn" id="close-submit-playlist">&times;</button>
            </div>
            
            <div class="form-container">
                <div class="form-info">
                    <h4>📋 订单信息</h4>
                    <div class="form-info-content">
                        <div class="song-count-info">
                            歌单歌曲: <span class="song-count-number" id="modal-song-count">0</span> 首
                        </div>
                        <div class="price-summary">
                            <div class="base-price" id="modal-base-price">套餐价格: RM 0</div>
                            <div class="shipping-fee" id="modal-shipping-fee">配送费用: RM 0</div>
                            <div class="total-price-summary" id="modal-total-price">总金额: RM 0</div>
                        </div>
                    </div>
                </div>
                
                <form id="submit-playlist-form">
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">
                                <span>姓名</span>
                                <span class="required">*</span>
                            </label>
                            <input type="text" class="form-input" id="customer-name" 
                                   placeholder="请输入您的姓名" required>
                            <div class="error-message" id="customer-name-error"></div>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">
                                <span>电话号码</span>
                                <span class="required">*</span>
                            </label>
                            <input type="tel" class="form-input" id="customer-phone" 
                                   placeholder="请输入马来西亚电话号码" required>
                            <div class="error-message" id="customer-phone-error"></div>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">
                            <span>邮箱地址</span>
                            <span class="required">*</span>
                        </label>
                        <input type="email" class="form-input" id="customer-email" 
                               placeholder="请输入您的邮箱地址" required>
                        <div class="error-message" id="customer-email-error"></div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">
                                <span>街道地址</span>
                                <span class="required">*</span>
                            </label>
                            <input type="text" class="form-input" id="address-street" 
                                   placeholder="请输入街道地址" required>
                            <div class="error-message" id="address-street-error"></div>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">
                                <span>城市</span>
                                <span class="required">*</span>
                            </label>
                            <input type="text" class="form-input" id="address-city" 
                                   placeholder="请输入城市" required>
                            <div class="error-message" id="address-city-error"></div>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">
                                <span>州属</span>
                                <span class="required">*</span>
                            </label>
                            <input type="text" class="form-input" id="address-state" 
                                   placeholder="请输入州属" required>
                            <div class="error-message" id="address-state-error"></div>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">
                                <span>邮编</span>
                                <span class="required">*</span>
                            </label>
                            <input type="text" class="form-input" id="address-zip" 
                                   placeholder="请输入邮编" required>
                            <div class="error-message" id="address-zip-error"></div>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">
                            <span>配送地区</span>
                            <span class="required">*</span>
                        </label>
                        <div class="form-radio-group">
                            <label class="form-radio-label" id="west-malaysia-label">
                                <input type="radio" name="shipping-region" value="west" checked>
                                <span>西马 (免费配送)</span>
                            </label>
                            <label class="form-radio-label" id="east-malaysia-label">
                                <input type="radio" name="shipping-region" value="east">
                                <span>东马 (+RM 8.00)</span>
                            </label>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">
                            <span>备注 (选填)</span>
                        </label>
                        <textarea class="form-textarea" id="customer-note" 
                                  placeholder="如有特殊要求，请在此填写..."></textarea>
                    </div>
                    
                    <button type="submit" class="form-submit-btn" id="submit-order-btn">
                        提交订单
                    </button>
                </form>
            </div>
        </div>
    </div>

    <!-- 订单详情模态框 -->
    <div class="modal" id="order-details-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">订单详情</h2>
                <button class="close-btn" id="close-order-details">&times;</button>
            </div>
            
            <div id="order-details-content">
                <!-- 订单详情内容会动态加载到这里 -->
            </div>
        </div>
    </div>

    <!-- 批量操作模态框 -->
    <div class="modal" id="batch-operations-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">批量操作</h2>
                <button class="close-btn" id="close-batch-operations">&times;</button>
            </div>
            
            <div id="batch-operations-content">
                <!-- 批量操作内容会动态加载到这里 -->
            </div>
        </div>
    </div>

    <div class="container">
        <!-- 导航栏 -->
        <nav class="navbar">
            <div class="logo">
                🎤 定制你的专属歌厅
                <span class="version">v2.2.0</span>
            </div>
            
            <div class="nav-buttons">
                <button class="nav-btn active" id="karaoke-nav">
                    <span>🎵</span>
                    <span>点歌系统</span>
                </button>
                <button class="nav-btn" id="pricing-nav">
                    <span>💰</span>
                    <span>价格配套</span>
                </button>
                <button class="nav-btn" id="my-orders-nav" style="display: none;">
                    <span>📋</span>
                    <span>我的订单</span>
                </button>
                <button class="nav-btn" id="orders-nav" style="display: none;">
                    <span>👑</span>
                    <span>订单管理</span>
                </button>
            </div>
            
            <div class="user-section">
                <div class="user-info" id="user-info">
                    <div class="user-avatar" id="user-avatar">E</div>
                    <span class="user-email" id="user-email">Eros Seraph</span>
                    <button class="logout-btn" id="logout-btn">退出</button>
                </div>
                <button class="login-btn" id="login-btn">
                    <span>🔐</span>
                    <span>登录/注册</span>
                </button>
            </div>
        </nav>
        
        <!-- 页面容器 -->
        <div class="page-container">
            <!-- 点歌系统页面 -->
            <div id="karaoke-page">
                <!-- 移动端选项卡按钮 -->
                <div class="karaoke-tab-buttons" style="display: none;">
                    <button class="karaoke-tab-btn active" data-tab="songs-tab">
                        <span>🎵</span>
                        <span>搜索歌曲</span>
                    </button>
                    <button class="karaoke-tab-btn" data-tab="playlist-tab">
                        <span>📋</span>
                        <span>我的歌单</span>
                    </button>
                </div>
                
                <!-- 搜索结果区域 -->
                <div class="karaoke-tab-content active" id="songs-tab">
                    <div class="songs-section">
                        <h3 style="margin-bottom: 20px; font-size: 1.5rem;">🎵 搜索和选择歌曲</h3>
                        
                        <div class="charts-container">
                            <div class="chart-category active" data-category="chinese-pop">
                                华语流行
                            </div>
                            <div class="chart-category" data-category="western-pop">
                                欧美流行
                            </div>
                            <div class="chart-category" data-category="chinese-dj">
                                中文DJ
                            </div>
                            <div class="chart-category" data-category="chinese-artists">
                                华语歌手
                            </div>
                            <div class="chart-category" data-category="western-artists">
                                欧美歌手
                            </div>
                        </div>
                        
                        <!-- 歌手列表 -->
                        <div class="artists-container" id="artists-container" style="display: none;">
                            <div class="artist-category">
                                <h4>🎵 华语歌手 (50位)</h4>
                                <div class="artists-list" id="chinese-artists-list">
                                    <!-- 华语歌手列表会动态加载 -->
                                </div>
                            </div>
                            <div class="artist-category">
                                <h4>🌍 欧美歌手 (50位)</h4>
                                <div class="artists-list" id="western-artists-list">
                                    <!-- 欧美歌手列表会动态加载 -->
                                </div>
                            </div>
                        </div>
                        
                        <div class="search-container">
                            <input type="text" class="search-input" id="search-input" 
                                   placeholder="搜索歌曲名称、歌手或专辑...">
                            <button class="search-btn" id="search-btn">
                                <span>🔍</span>
                                <span>搜索</span>
                            </button>
                            <button class="clear-btn" id="clear-search-btn">
                                <span>🗑️</span>
                                <span>清空</span>
                            </button>
                        </div>
                        
                        <div class="songs-container" id="songs-container">
                            <div class="loading">
                                <div class="loading-spinner"></div>
                                <div>正在加载歌曲...</div>
                            </div>
                        </div>
                        
                        <button class="load-more-btn" id="load-more-btn" style="display: none;">
                            <span>⬇️</span>
                            <span>加载更多歌曲</span>
                        </button>
                    </div>
                </div>
                
                <!-- 歌单区域 -->
                <div class="karaoke-tab-content" id="playlist-tab">
                    <div class="playlist-section">
                        <div class="playlist-header">
                            <div class="playlist-count">
                                <span>我的歌单</span>
                                <span class="playlist-count-number" id="playlist-count">0</span>
                            </div>
                            <button class="submit-playlist-btn" id="submit-playlist-btn" disabled>
                                <span>📤</span>
                                <span>提交歌单</span>
                            </button>
                        </div>
                        
                        <div class="playlist-items" id="playlist-items">
                            <div class="empty-playlist">
                                <div class="empty-playlist-icon">🎵</div>
                                <div class="empty-playlist-message">歌单为空</div>
                                <div class="empty-playlist-submessage">
                                    请从左侧添加歌曲到歌单
                                </div>
                            </div>
                        </div>
                        
                        <div class="price-recommendation" id="price-recommendation" style="display: none;">
                            <h4>💰 价格推荐</h4>
                            <div class="recommended-plan">
                                <span class="plan-name" id="recommended-plan-name">基础版</span>
                                <span class="plan-price" id="recommended-plan-price">RM 29</span>
                            </div>
                            <div class="shipping-cost">
                                <span>配送费用</span>
                                <span id="shipping-cost-text">RM 0 (西马免费)</span>
                            </div>
                            <div class="total-price">
                                <span>总计金额</span>
                                <span id="total-price-text">RM 29</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- 价格配套页面 -->
            <div id="pricing-page">
                <div class="pricing-header">
                    <h2>💰 价格配套选择</h2>
                    <p style="opacity: 0.8; margin-top: 10px;">选择适合您的歌曲数量配套</p>
                </div>
                
                <div class="pricing-container">
                    <div class="pricing-card">
                        <div class="plan-name">基础版</div>
                        <div class="price">RM 29</div>
                        <div class="song-range">1 - 20 首歌曲</div>
                        <button class="select-btn" data-plan="basic">
                            选择此配套
                        </button>
                    </div>
                    
                    <div class="pricing-card">
                        <div class="plan-name">标准版</div>
                        <div class="price">RM 49</div>
                        <div class="song-range">21 - 50 首歌曲</div>
                        <button class="select-btn" data-plan="standard">
                            选择此配套
                        </button>
                    </div>
                    
                    <div class="pricing-card popular">
                        <div class="popular-badge">最受欢迎</div>
                        <div class="plan-name">进阶版</div>
                        <div class="price">RM 69</div>
                        <div class="song-range">51 - 100 首歌曲</div>
                        <button class="select-btn" data-plan="premium">
                            选择此配套
                        </button>
                    </div>
                    
                    <div class="pricing-card">
                        <div class="plan-name">豪华版</div>
                        <div class="price">RM 89</div>
                        <div class="song-range">101 - 200 首歌曲</div>
                        <button class="select-btn" data-plan="deluxe">
                            选择此配套
                        </button>
                    </div>
                    
                    <div class="pricing-card">
                        <div class="plan-name">专业版</div>
                        <div class="price">RM 109</div>
                        <div class="song-range">201 - 300 首歌曲</div>
                        <button class="select-btn" data-plan="professional">
                            选择此配套
                        </button>
                    </div>
                    
                    <div class="pricing-card">
                        <div class="plan-name">旗舰版</div>
                        <div class="price">RM 129</div>
                        <div class="song-range">301 - 400 首歌曲</div>
                        <button class="select-btn" data-plan="flagship">
                            选择此配套
                        </button>
                    </div>
                    
                    <div class="pricing-card">
                        <div class="plan-name">至尊版</div>
                        <div class="price">RM 159</div>
                        <div class="song-range">401 - 500 首歌曲</div>
                        <button class="select-btn" data-plan="ultimate">
                            选择此配套
                        </button>
                    </div>
                    
                    <div class="pricing-card">
                        <div class="plan-name">自定义版</div>
                        <div class="price">RM 0.30/每首</div>
                        <div class="song-range">501+ 首歌曲</div>
                        <button class="select-btn" data-plan="custom">
                            联系定制
                        </button>
                    </div>
                </div>
                
                <!-- 配送信息 -->
                <div class="shipping-info">
                    <h3>🚚 配送信息</h3>
                    <div class="shipping-options">
                        <div class="shipping-option">
                            <div class="shipping-header">
                                <span class="shipping-region">
                                    <span>🇲🇾</span>
                                    <span>西马</span>
                                </span>
                                <span class="shipping-price">免费配送</span>
                            </div>
                            <div class="shipping-desc">
                                预计 5-7 个工作日内送达
                            </div>
                        </div>
                        <div class="shipping-option">
                            <div class="shipping-header">
                                <span class="shipping-region">
                                    <span>✈️</span>
                                    <span>东马</span>
                                </span>
                                <span class="shipping-price">RM 8.00</span>
                            </div>
                            <div class="shipping-desc">
                                预计 7-10 个工作日内送达
                            </div>
                        </div>
                    </div>
                    <div class="shipping-note">
                        * 所有配套均包含完整的技术支持和售后服务
                    </div>
                </div>
            </div>
            
            <!-- 我的订单页面 -->
            <div id="my-orders-page">
                <div class="my-orders-header">
                    <h2>📋 我的订单</h2>
                    <div class="my-orders-controls">
                        <button class="refresh-btn" id="refresh-my-orders-btn">
                            <span>🔄</span>
                            <span>刷新</span>
                        </button>
                        <button class="filter-btn" id="filter-my-orders-btn">
                            <span>🔍</span>
                            <span>筛选</span>
                        </button>
                    </div>
                </div>
                
                <!-- 筛选面板 -->
                <div class="filter-panel" id="my-orders-filter-panel">
                    <div class="filter-row">
                        <div class="filter-group">
                            <label class="filter-label">订单状态</label>
                            <select class="filter-select" id="my-orders-filter-status">
                                <option value="all">全部状态</option>
                                <option value="pending">待付款</option>
                                <option value="paid">已付款</option>
                                <option value="shipped">已发货</option>
                                <option value="completed">已完成</option>
                                <option value="cancelled">已取消</option>
                            </select>
                        </div>
                        
                        <div class="filter-group">
                            <label class="filter-label">开始日期</label>
                            <input type="date" class="filter-date" id="my-orders-filter-start-date">
                        </div>
                        
                        <div class="filter-group">
                            <label class="filter-label">结束日期</label>
                            <input type="date" class="filter-date" id="my-orders-filter-end-date">
                        </div>
                    </div>
                    
                    <div class="filter-actions">
                        <button class="clear-filter-btn" id="clear-my-orders-filter-btn">
                            清除筛选
                        </button>
                        <button class="apply-filter-btn" id="apply-my-orders-filter-btn">
                            应用筛选
                        </button>
                    </div>
                </div>
                
                <!-- 分页控件 -->
                <div class="pagination-container" id="my-orders-pagination">
                    <!-- 分页按钮将动态生成 -->
                </div>
                
                <!-- 订单表格 -->
                <div class="my-orders-container">
                    <table class="my-orders-table">
                        <thead>
                            <tr>
                                <th>订单号</th>
                                <th>套餐类型</th>
                                <th>歌曲数量</th>
                                <th>总金额</th>
                                <th>配送地区</th>
                                <th>订单状态</th>
                                <th>创建时间</th>
                                <th>操作</th>
                            </tr>
                        </thead>
                        <tbody id="my-orders-table-body">
                            <tr>
                                <td colspan="8" style="text-align: center; padding: 60px;">
                                    <div class="loading">
                                        <div class="loading-spinner"></div>
                                        <div>正在加载订单数据...</div>
                                    </div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                
                <!-- 分页控件 -->
                <div class="pagination-container" id="my-orders-pagination-bottom">
                    <!-- 分页按钮将动态生成 -->
                </div>
            </div>
            
            <!-- 订单管理页面 -->
            <div id="orders-page">
                <div class="orders-header">
                    <h2>👑 订单管理系统</h2>
                    <div class="orders-controls">
                        <button class="export-btn" id="export-excel-btn">
                            <span>📊</span>
                            <span>导出Excel</span>
                        </button>
                        <button class="refresh-btn" id="refresh-orders-btn">
                            <span>🔄</span>
                            <span>刷新订单</span>
                        </button>
                        <button class="filter-btn" id="filter-orders-btn">
                            <span>🔍</span>
                            <span>筛选订单</span>
                        </button>
                        <button class="batch-btn" id="batch-operations-btn" style="display: none;">
                            <span>⚙️</span>
                            <span>批量操作</span>
                        </button>
                    </div>
                </div>
                
                <!-- 筛选面板 -->
                <div class="filter-panel" id="filter-panel">
                    <div class="filter-row">
                        <div class="filter-group">
                            <label class="filter-label">订单状态</label>
                            <select class="filter-select" id="filter-status">
                                <option value="all">全部状态</option>
                                <option value="pending">待付款</option>
                                <option value="paid">已付款</option>
                                <option value="shipped">已发货</option>
                                <option value="completed">已完成</option>
                                <option value="cancelled">已取消</option>
                                <option value="deleted">已删除</option>
                            </select>
                        </div>
                        
                        <div class="filter-group">
                            <label class="filter-label">顾客姓名</label>
                            <input type="text" class="filter-input" id="filter-customer-name" 
                                   placeholder="输入顾客姓名">
                        </div>
                        
                        <div class="filter-group">
                            <label class="filter-label">开始日期</label>
                            <input type="date" class="filter-date" id="filter-start-date">
                        </div>
                        
                        <div class="filter-group">
                            <label class="filter-label">结束日期</label>
                            <input type="date" class="filter-date" id="filter-end-date">
                        </div>
                    </div>
                    
                    <div class="filter-actions">
                        <button class="clear-filter-btn" id="clear-filter-btn">
                            清除筛选
                        </button>
                        <button class="apply-filter-btn" id="apply-filter-btn">
                            应用筛选
                        </button>
                    </div>
                </div>
                
                <!-- 批量操作面板 -->
                <div class="batch-panel" id="batch-panel">
                    <div class="batch-info">
                        <span>已选择</span>
                        <span class="batch-selected-count" id="batch-selected-count">0</span>
                        <span>个订单</span>
                    </div>
                    <div class="batch-actions">
                        <button class="batch-action-btn batch-export-btn" id="batch-export-btn">
                            <span>📥</span>
                            <span>导出选中</span>
                        </button>
                        <button class="batch-action-btn batch-status-btn" id="batch-status-btn">
                            <span>🔄</span>
                            <span>批量改状态</span>
                        </button>
                        <button class="batch-action-btn batch-delete-btn" id="batch-delete-btn">
                            <span>🗑️</span>
                            <span>批量删除</span>
                        </button>
                        <button class="batch-action-btn batch-clear-btn" id="batch-clear-btn">
                            <span>✖️</span>
                            <span>取消选择</span>
                        </button>
                    </div>
                </div>
                
                <!-- 统计卡片 -->
                <div class="stats-cards" id="stats-cards">
                    <div class="stat-card">
                        <div class="stat-card-icon">📊</div>
                        <div class="stat-card-value" id="stat-total-orders">0</div>
                        <div class="stat-card-label">总订单数</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-card-icon">💰</div>
                        <div class="stat-card-value" id="stat-total-revenue">RM 0</div>
                        <div class="stat-card-label">总收入</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-card-icon">📈</div>
                        <div class="stat-card-value" id="stat-avg-order">RM 0</div>
                        <div class="stat-card-label">平均订单</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-card-icon">🎵</div>
                        <div class="stat-card-value" id="stat-total-songs">0</div>
                        <div class="stat-card-label">总歌曲数</div>
                    </div>
                </div>
                
                <!-- 分页控件 -->
                <div class="pagination-container" id="orders-pagination">
                    <!-- 分页按钮将动态生成 -->
                </div>
                
                <!-- 订单表格 -->
                <div class="orders-table-container">
                    <table class="orders-table" id="orders-table">
                        <thead>
                            <tr>
                                <th class="select-checkbox">
                                    <input type="checkbox" id="select-all-checkbox">
                                </th>
                                <th>订单号</th>
                                <th>顾客姓名</th>
                                <th>套餐类型</th>
                                <th>歌曲数量</th>
                                <th>总金额</th>
                                <th>配送地区</th>
                                <th>订单状态</th>
                                <th>创建时间</th>
                                <th>操作</th>
                            </tr>
                        </thead>
                        <tbody id="orders-table-body">
                            <tr>
                                <td colspan="10" style="text-align: center; padding: 60px;">
                                    <div class="loading">
                                        <div class="loading-spinner"></div>
                                        <div>正在加载订单数据...</div>
                                    </div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                
                <!-- 分页控件 -->
                <div class="pagination-container" id="orders-pagination-bottom">
                    <!-- 分页按钮将动态生成 -->
                </div>
            </div>
        </div>
    </div>

    <script>
        // ============================================
        // 定制歌厅系统 v2.2.0 - JavaScript代码
        // ============================================
        
        // ==================== Firebase 配置 ====================
        function getFirebaseConfig() {
            return {
                apiKey: "AIzaSyAMn7EOOUDpIGXzA8EhPBtLWw7BwyU2Rdc",
                authDomain: "karaoke-customizer.firebaseapp.com",
                projectId: "karaoke-customizer",
                storageBucket: "karaoke-customizer.firebasestorage.app",
                messagingSenderId: "593643512892",
                appId: "1:593643512892:web:c21ec4ce7c2d286fed4f39",
                measurementId: "G-D791D33Y6R"
            };
        }

        // ==================== 应用状态变量 ====================
        let currentUser = null;
        let currentSongs = [];
        let playlist = [];
        let orders = [];
        let myOrders = [];
        let selectedOrders = new Set();
        let currentSearchOffset = 0;
        let currentSearchTerm = '';
        let currentChartCategory = 'chinese-pop';
        let isAdmin = false;
        let firebaseApp, auth, firestore, analytics;
        
        // API缓存
        let apiCache = {
            artists: {},
            charts: {},
            search: {}
        };
        
        // 防抖定时器
        let searchDebounceTimer = null;
        
        // 音频播放器
        let currentAudio = null;
        let currentlyPlayingId = null;

        // ==================== 页面初始化 ====================
        document.addEventListener('DOMContentLoaded', function() {
            console.log('🚀 初始化定制歌厅系统 v2.2.0...');
            
            // 初始化Firebase
            initializeFirebase();
            
            // 初始化页面导航
            initPageNavigation();
            
            // 初始化事件监听（使用事件委托）
            setupEventListeners();
            
            // 初始化分页管理器
            initPagination();
            
            // 初始化移动端选项卡
            initMobileTabs();
            
            // 加载歌手列表
            loadArtistsList();
            
            // 加载默认排行榜
            loadChartOptimized('chinese-pop');
            
            // 从本地存储恢复歌单
            restorePlaylistFromStorage();
            
            // 设置窗口大小变化监听
            window.addEventListener('resize', initMobileTabs);
        });

        // ==================== Firebase 初始化 ====================
        function initializeFirebase() {
            try {
                const firebaseConfig = getFirebaseConfig();
                console.log('🔧 Firebase 配置:', firebaseConfig);
                
                firebaseApp = firebase.initializeApp(firebaseConfig);
                auth = firebaseApp.auth();
                firestore = firebaseApp.firestore();
                analytics = firebaseApp.analytics();
                
                console.log('✅ Firebase 初始化成功');
                
                // 设置认证状态监听
                auth.onAuthStateChanged(handleAuthStateChange);
                
            } catch (error) {
                console.error('❌ Firebase 初始化失败:', error);
                showMessage('系统初始化失败，请刷新页面重试', 'error');
            }
        }

        function handleAuthStateChange(user) {
            if (user) {
                console.log('✅ 用户已登录:', user.email);
                currentUser = user;
                updateUserUI();
                
                // 检查管理员状态
                checkAdminStatus(user);
                
                // 同步本地歌单到用户账号
                syncPlaylistWithUser();
                
            } else {
                console.log('❌ 用户已退出');
                currentUser = null;
                updateUserUI();
            }
        }

        // ==================== 检查管理员状态 ====================
        function checkAdminStatus(user) {
            try {
                // 管理员邮箱列表
                const adminEmails = [
                    'erosseraph@gmail.com',
                    'admin@karaoke.com'
                ].map(email => email.toLowerCase());
                
                const userEmail = user.email.toLowerCase();
                isAdmin = adminEmails.includes(userEmail);
                
                // 获取管理元素
                const ordersNav = document.getElementById('orders-nav');
                const myOrdersNav = document.getElementById('my-orders-nav');
                const batchBtn = document.getElementById('batch-operations-btn');
                
                // 所有登录用户都可以看到"我的订单"
                myOrdersNav.style.display = 'block';
                
                if (isAdmin) {
                    ordersNav.style.display = 'block';
                    batchBtn.style.display = 'flex';
                    console.log('👑 ' + user.email + ' 是管理员');
                    
                    if (document.getElementById('orders-page').style.display === 'block') {
                        loadOrders();
                    }
                } else {
                    ordersNav.style.display = 'none';
                    batchBtn.style.display = 'none';
                    console.log('🚫 ' + user.email + ' 不是管理员');
                }
                
            } catch (error) {
                console.error('检查管理员状态失败:', error);
            }
        }

        // ==================== 移动端选项卡初始化 ====================
        function initMobileTabs() {
            // 检查是否为移动端
            const isMobile = window.innerWidth <= 767;
            const tabButtons = document.querySelector('.karaoke-tab-buttons');
            const songsTab = document.getElementById('songs-tab');
            const playlistTab = document.getElementById('playlist-tab');
            
            if (isMobile) {
                // 显示选项卡按钮
                tabButtons.style.display = 'flex';
                
                // 隐藏歌单区域
                playlistTab.style.display = 'none';
                playlistTab.classList.remove('active');
                
                // 只显示搜索区域
                songsTab.style.display = 'block';
                songsTab.classList.add('active');
                
            } else {
                // 桌面端：隐藏选项卡，显示左右布局
                tabButtons.style.display = 'none';
                songsTab.style.display = 'block';
                playlistTab.style.display = 'block';
                songsTab.classList.add('active');
                playlistTab.classList.add('active');
            }
        }

        // ==================== 页面导航功能 ====================
        function initPageNavigation() {
            const karaokeNav = document.getElementById('karaoke-nav');
            const pricingNav = document.getElementById('pricing-nav');
            const myOrdersNav = document.getElementById('my-orders-nav');
            const ordersNav = document.getElementById('orders-nav');
            
            karaokeNav.addEventListener('click', function() {
                showPage('karaoke');
                setActiveNav(this);
            });
            
            pricingNav.addEventListener('click', function() {
                showPage('pricing');
                setActiveNav(this);
            });
            
            myOrdersNav.addEventListener('click', function() {
                showPage('my-orders');
                setActiveNav(this);
                loadMyOrders();
            });
            
            ordersNav.addEventListener('click', function() {
                showPage('orders');
                setActiveNav(this);
                loadOrders();
            });
        }
        
        function showPage(page) {
            const karaokePage = document.getElementById('karaoke-page');
            const pricingPage = document.getElementById('pricing-page');
            const myOrdersPage = document.getElementById('my-orders-page');
            const ordersPage = document.getElementById('orders-page');
            
            // 隐藏所有页面
            karaokePage.style.display = 'none';
            pricingPage.style.display = 'none';
            myOrdersPage.style.display = 'none';
            ordersPage.style.display = 'none';
            
            // 隐藏筛选面板和批量面板
            document.getElementById('filter-panel').classList.remove('show');
            document.getElementById('my-orders-filter-panel').classList.remove('show');
            document.getElementById('batch-panel').classList.remove('show');
            selectedOrders.clear();
            updateBatchPanel();
            
            // 显示目标页面
            if (page === 'karaoke') {
                karaokePage.style.display = 'flex';
                // 重新初始化移动端选项卡
                initMobileTabs();
            } else if (page === 'pricing') {
                pricingPage.style.display = 'block';
            } else if (page === 'my-orders') {
                myOrdersPage.style.display = 'block';
            } else if (page === 'orders') {
                ordersPage.style.display = 'block';
            }
        }
        
        function setActiveNav(activeButton) {
            document.querySelectorAll('.nav-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            activeButton.classList.add('active');
        }

        // ==================== 事件监听器设置（使用事件委托） ====================
        function setupEventListeners() {
            // 使用事件委托处理动态元素
            document.addEventListener('click', function(e) {
                // 排行榜点击事件
                if (e.target.closest('.chart-category')) {
                    const chart = e.target.closest('.chart-category');
                    const category = chart.dataset.category;
                    currentChartCategory = category;
                    
                    // 如果是歌手分类，显示歌手列表
                    if (category === 'chinese-artists' || category === 'western-artists') {
                        document.getElementById('artists-container').style.display = 'grid';
                    } else {
                        document.getElementById('artists-container').style.display = 'none';
                        loadChartOptimized(category);
                    }
                    
                    // 更新活跃状态
                    document.querySelectorAll('.chart-category').forEach(c => {
                        c.classList.remove('active');
                    });
                    chart.classList.add('active');
                }
                
                // 歌手点击事件
                if (e.target.closest('.artist-item')) {
                    const artistItem = e.target.closest('.artist-item');
                    const artistName = artistItem.dataset.artist;
                    searchByArtist(artistName);
                }
                
                // 移动端选项卡点击事件
                if (e.target.closest('.karaoke-tab-btn')) {
                    const tabBtn = e.target.closest('.karaoke-tab-btn');
                    const tabId = tabBtn.dataset.tab;
                    
                    // 更新按钮状态
                    document.querySelectorAll('.karaoke-tab-btn').forEach(b => {
                        b.classList.remove('active');
                    });
                    tabBtn.classList.add('active');
                    
                    // 显示对应内容
                    document.querySelectorAll('.karaoke-tab-content').forEach(content => {
                        content.style.display = 'none';
                        content.classList.remove('active');
                    });
                    
                    const targetTab = document.getElementById(tabId);
                    targetTab.style.display = 'block';
                    targetTab.classList.add('active');
                }
                
                // 歌曲预览按钮
                if (e.target.closest('.preview-btn')) {
                    const previewBtn = e.target.closest('.preview-btn');
                    const songId = previewBtn.dataset.songId;
                    togglePreview(songId);
                }
                
                // 添加歌曲按钮
                if (e.target.closest('.add-btn')) {
                    const addBtn = e.target.closest('.add-btn');
                    const songId = parseInt(addBtn.dataset.songId);
                    addToPlaylist(songId);
                }
                
                // 移除歌曲按钮
                if (e.target.closest('.remove-btn')) {
                    const removeBtn = e.target.closest('.remove-btn');
                    const songId = parseInt(removeBtn.dataset.songId);
                    removeFromPlaylist(songId);
                }
                
                // 查看订单详情按钮
                if (e.target.closest('.view-btn')) {
                    const viewBtn = e.target.closest('.view-btn');
                    const orderId = viewBtn.dataset.orderId;
                    viewOrderDetails(orderId);
                }
                
                // 编辑订单按钮
                if (e.target.closest('.edit-btn')) {
                    const editBtn = e.target.closest('.edit-btn');
                    const orderId = editBtn.dataset.orderId;
                    editOrder(orderId);
                }
                
                // 删除订单按钮
                if (e.target.closest('.delete-btn')) {
                    const deleteBtn = e.target.closest('.delete-btn');
                    const orderId = deleteBtn.dataset.orderId;
                    deleteOrder(orderId);
                }
                
                // 订单选择复选框
                if (e.target.closest('.order-checkbox')) {
                    const checkbox = e.target.closest('.order-checkbox');
                    const orderId = checkbox.dataset.orderId;
                    toggleOrderSelection(orderId, checkbox.checked);
                }
                
                // 模态框关闭按钮
                if (e.target.closest('.close-btn')) {
                    const modal = e.target.closest('.modal');
                    if (modal) {
                        modal.style.display = 'none';
                    }
                }
            });
            
            // 搜索功能
            const searchBtn = document.getElementById('search-btn');
            const searchInput = document.getElementById('search-input');
            
            searchBtn.addEventListener('click', performSearch);
            searchInput.addEventListener('input', function(e) {
                // 防抖处理：延迟500ms执行搜索
                clearTimeout(searchDebounceTimer);
                searchDebounceTimer = setTimeout(() => {
                    if (e.target.value.trim() === '') {
                        loadChartOptimized(currentChartCategory);
                    } else {
                        performSearch();
                    }
                }, 500);
            });
            
            // 清空搜索
            document.getElementById('clear-search-btn').addEventListener('click', function() {
                document.getElementById('search-input').value = '';
                loadChartOptimized(currentChartCategory);
            });
            
            // 加载更多歌曲
            document.getElementById('load-more-btn').addEventListener('click', loadMoreSongs);
            
            // 提交歌单按钮
            document.getElementById('submit-playlist-btn').addEventListener('click', function() {
                if (playlist.length === 0) {
                    showMessage('歌单为空，请先添加歌曲', 'warning');
                    return;
                }
                
                if (!currentUser) {
                    showMessage('请先登录以提交订单', 'warning');
                    document.getElementById('login-modal').style.display = 'flex';
                    return;
                }
                
                showSubmitPlaylistModal();
            });
            
            // 登录模态框
            document.getElementById('login-btn').addEventListener('click', function() {
                document.getElementById('login-modal').style.display = 'flex';
            });
            
            // 价格配套按钮
            document.querySelectorAll('.select-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const plan = this.dataset.plan;
                    handlePlanSelection(plan);
                });
            });
            
            // 登录方式按钮
            document.getElementById('email-login-btn').addEventListener('click', function() {
                showEmailLoginForm();
            });
            
            document.getElementById('google-login-btn').addEventListener('click', function() {
                signInWithGoogle();
            });
            
            // 订单管理按钮
            document.getElementById('refresh-orders-btn').addEventListener('click', function() {
                loadOrders();
            });
            
            document.getElementById('export-excel-btn').addEventListener('click', function() {
                exportOrdersToExcel();
            });
            
            document.getElementById('filter-orders-btn').addEventListener('click', function() {
                const filterPanel = document.getElementById('filter-panel');
                filterPanel.classList.toggle('show');
            });
            
            document.getElementById('batch-operations-btn').addEventListener('click', function() {
                showBatchOperationsModal();
            });
            
            // 我的订单按钮
            document.getElementById('refresh-my-orders-btn').addEventListener('click', function() {
                loadMyOrders();
            });
            
            document.getElementById('filter-my-orders-btn').addEventListener('click', function() {
                const filterPanel = document.getElementById('my-orders-filter-panel');
                filterPanel.classList.toggle('show');
            });
            
            // 筛选功能
            document.getElementById('apply-filter-btn').addEventListener('click', applyFilters);
            document.getElementById('clear-filter-btn').addEventListener('click', clearFilters);
            document.getElementById('apply-my-orders-filter-btn').addEventListener('click', applyMyOrdersFilters);
            document.getElementById('clear-my-orders-filter-btn').addEventListener('click', clearMyOrdersFilters);
            
            // 批量操作
            document.getElementById('batch-export-btn').addEventListener('click', batchExportOrders);
            document.getElementById('batch-status-btn').addEventListener('click', batchUpdateStatus);
            document.getElementById('batch-delete-btn').addEventListener('click', batchDeleteOrders);
            document.getElementById('batch-clear-btn').addEventListener('click', clearSelectedOrders);
            
            // 全选复选框
            document.getElementById('select-all-checkbox').addEventListener('change', function() {
                const checkboxes = document.querySelectorAll('.order-checkbox');
                checkboxes.forEach(checkbox => {
                    checkbox.checked = this.checked;
                    if (this.checked) {
                        selectedOrders.add(checkbox.dataset.orderId);
                    } else {
                        selectedOrders.delete(checkbox.dataset.orderId);
                    }
                });
                updateBatchPanel();
            });
            
            // 退出登录
            document.getElementById('logout-btn').addEventListener('click', function() {
                if (auth) {
                    auth.signOut();
                }
            });
            
            // 配送地区选择
            document.querySelectorAll('input[name="shipping-region"]').forEach(radio => {
                radio.addEventListener('change', function() {
                    updatePriceRecommendation();
                    if (document.getElementById('submit-playlist-modal').style.display === 'flex') {
                        updateModalPrice();
                    }
                });
            });
            
            // 提交订单表单
            document.getElementById('submit-playlist-form').addEventListener('submit', function(e) {
                e.preventDefault();
                submitOrder();
            });
        }

        // ==================== 歌手列表功能 ====================
        function loadArtistsList() {
            const chineseArtists = [
                "周杰伦", "林俊杰", "陈奕迅", "王力宏", "邓紫棋",
                "蔡依林", "孙燕姿", "张惠妹", "李荣浩", "薛之谦",
                "张杰", "华晨宇", "毛不易", "许嵩", "杨千嬅",
                "梁静茹", "王菲", "张学友", "刘德华", "郭富城",
                "黎明", "莫文蔚", "张信哲", "任贤齐", "刘若英",
                "田馥甄", "萧敬腾", "五月天", "S.H.E", "飞儿乐团",
                "Beyond", "谭咏麟", "张国荣", "梅艳芳", "陈慧娴",
                "容祖儿", "杨丞琳", "蔡健雅", "徐佳莹", "林忆莲",
                "汪峰", "那英", "韩红", "张韶涵", "范玮琪",
                "周笔畅", "李宇春", "张靓颖", "尚雯婕", "吴青峰"
            ];
            
            const westernArtists = [
                "Taylor Swift", "Ed Sheeran", "Adele", "Bruno Mars", "Billie Eilish",
                "Justin Bieber", "Lady Gaga", "Rihanna", "Katy Perry", "Drake",
                "Post Malone", "The Weeknd", "Ariana Grande", "Dua Lipa", "Harry Styles",
                "Shawn Mendes", "Coldplay", "Maroon 5", "Imagine Dragons", "OneRepublic",
                "Queen", "The Beatles", "Elvis Presley", "Michael Jackson", "Madonna",
                "Beyoncé", "Eminem", "Kanye West", "Jay-Z", "Bob Dylan",
                "Elton John", "Whitney Houston", "Mariah Carey", "Celine Dion", "Britney Spears",
                "Christina Aguilera", "Pink", "Avril Lavigne", "Linkin Park", "Green Day",
                "Nirvana", "Metallica", "AC/DC", "Guns N' Roses", "U2",
                "Radiohead", "Red Hot Chili Peppers", "Foo Fighters", "Blink-182", "The Rolling Stones"
            ];
            
            // 填充华语歌手列表
            const chineseList = document.getElementById('chinese-artists-list');
            chineseList.innerHTML = '';
            chineseArtists.forEach(artist => {
                const artistItem = document.createElement('div');
                artistItem.className = 'artist-item';
                artistItem.dataset.artist = artist;
                artistItem.innerHTML = `
                    <span>${artist}</span>
                    <span style="opacity: 0.6; font-size: 0.85rem;">→</span>
                `;
                chineseList.appendChild(artistItem);
            });
            
            // 填充欧美歌手列表
            const westernList = document.getElementById('western-artists-list');
            westernList.innerHTML = '';
            westernArtists.forEach(artist => {
                const artistItem = document.createElement('div');
                artistItem.className = 'artist-item';
                artistItem.dataset.artist = artist;
                artistItem.innerHTML = `
                    <span>${artist}</span>
                    <span style="opacity: 0.6; font-size: 0.85rem;">→</span>
                `;
                westernList.appendChild(artistItem);
            });
        }

        // ==================== 搜索功能（轮询填充策略） ====================
        function performSearch() {
            const searchTerm = document.getElementById('search-input').value.trim();
            currentSearchTerm = searchTerm;
            currentSearchOffset = 0;
            
            if (searchTerm === '') {
                loadChartOptimized(currentChartCategory);
                return;
            }
            
            // 显示加载状态
            const songsContainer = document.getElementById('songs-container');
            songsContainer.innerHTML = `
                <div class="loading">
                    <div class="loading-spinner"></div>
                    <div>正在搜索歌曲...</div>
                </div>
            `;
            
            document.getElementById('load-more-btn').style.display = 'none';
            
            // 检查缓存
            const cacheKey = `search_${searchTerm}_${currentSearchOffset}`;
            if (apiCache.search[cacheKey]) {
                console.log('📦 使用缓存的搜索结果');
                displaySongs(apiCache.search[cacheKey]);
                return;
            }
            
            // 轮询填充策略：iTunes官方榜 → 热门关键词 → 歌手补充
            searchWithPollingStrategy(searchTerm);
        }
        
        function searchWithPollingStrategy(searchTerm) {
            const searchPromises = [];
            
            // 策略1: iTunes官方榜搜索
            searchPromises.push(searchItunesCharts(searchTerm));
            
            // 策略2: 热门关键词搜索
            searchPromises.push(searchWithPopularKeywords(searchTerm));
            
            // 策略3: 歌手补充搜索
            searchPromises.push(searchByArtistSupplement(searchTerm));
            
            // 执行所有搜索策略
            Promise.allSettled(searchPromises).then(results => {
                let allSongs = [];
                let uniqueSongIds = new Set();
                
                // 合并结果，去重
                results.forEach(result => {
                    if (result.status === 'fulfilled' && result.value && result.value.length > 0) {
                        result.value.forEach(song => {
                            if (!uniqueSongIds.has(song.id)) {
                                uniqueSongIds.add(song.id);
                                allSongs.push(song);
                            }
                        });
                    }
                });
                
                // 确保至少50首歌曲
                if (allSongs.length < 50) {
                    // 补充更多歌曲
                    supplementWithFallbackSongs(searchTerm, allSongs, uniqueSongIds);
                }
                
                // 缓存结果
                const cacheKey = `search_${searchTerm}_${currentSearchOffset}`;
                apiCache.search[cacheKey] = allSongs.slice(0, 50);
                
                // 显示结果
                if (allSongs.length === 0) {
                    showNoResults(searchTerm);
                } else {
                    displaySongs(allSongs.slice(0, 50));
                }
            }).catch(error => {
                console.error('搜索失败:', error);
                showApiError();
            });
        }
        
        function searchItunesCharts(searchTerm) {
            return new Promise((resolve) => {
                // 模拟iTunes API调用
                setTimeout(() => {
                    // 这里应该是实际的iTunes API调用
                    // 暂时使用模拟数据
                    const mockSongs = generateMockSongs(searchTerm, 20, 'itunes');
                    resolve(mockSongs);
                }, 500);
            });
        }
        
        function searchWithPopularKeywords(searchTerm) {
            return new Promise((resolve) => {
                setTimeout(() => {
                    // 基于搜索词的热门歌曲
                    const mockSongs = generateMockSongs(searchTerm, 20, 'popular');
                    resolve(mockSongs);
                }, 600);
            });
        }
        
        function searchByArtistSupplement(searchTerm) {
            return new Promise((resolve) => {
                setTimeout(() => {
                    // 基于歌手的补充歌曲
                    const mockSongs = generateMockSongs(searchTerm, 20, 'artist');
                    resolve(mockSongs);
                }, 700);
            });
        }
        
        function supplementWithFallbackSongs(searchTerm, existingSongs, uniqueSongIds) {
            // 补充随机歌曲以达到50首
            const needed = 50 - existingSongs.length;
            if (needed > 0) {
                const fallbackSongs = generateMockSongs(searchTerm, needed, 'fallback');
                fallbackSongs.forEach(song => {
                    if (!uniqueSongIds.has(song.id)) {
                        uniqueSongIds.add(song.id);
                        existingSongs.push(song);
                    }
                });
            }
        }
        
        function generateMockSongs(searchTerm, count, source) {
            const songs = [];
            const artists = searchTerm.includes('周杰伦') ? ['周杰伦'] : 
                           searchTerm.includes('Taylor') ? ['Taylor Swift'] :
                           ['未知歌手'];
            
            for (let i = 0; i < count; i++) {
                songs.push({
                    id: Date.now() + i + (source === 'itunes' ? 1000 : source === 'popular' ? 2000 : 3000),
                    title: `${searchTerm} 歌曲 ${i + 1}`,
                    artist: artists[0],
                    album: `${searchTerm} 专辑 ${i + 1}`,
                    previewUrl: null
                });
            }
            return songs;
        }
        
        function searchByArtist(artistName) {
            document.getElementById('search-input').value = artistName;
            performSearch();
        }
        
        function loadMoreSongs() {
            currentSearchOffset += 50;
            
            if (currentSearchTerm) {
                // 搜索更多结果
                const cacheKey = `search_${currentSearchTerm}_${currentSearchOffset}`;
                if (apiCache.search[cacheKey]) {
                    const moreSongs = apiCache.search[cacheKey];
                    displaySongs([...currentSongs, ...moreSongs], true);
                } else {
                    // 模拟加载更多
                    setTimeout(() => {
                        const moreSongs = generateMockSongs(currentSearchTerm, 20, 'more');
                        apiCache.search[cacheKey] = moreSongs;
                        displaySongs([...currentSongs, ...moreSongs], true);
                    }, 800);
                }
            } else {
                // 加载更多排行榜歌曲
                loadChartOptimized(currentChartCategory, true);
            }
        }

        // ==================== 排行榜功能 ====================
        function loadChartOptimized(category, loadMore = false) {
            if (!loadMore) {
                currentSearchOffset = 0;
                
                // 显示加载状态
                const songsContainer = document.getElementById('songs-container');
                songsContainer.innerHTML = `
                    <div class="loading">
                        <div class="loading-spinner"></div>
                        <div>正在加载${getChartCategoryName(category)}...</div>
                    </div>
                `;
                
                document.getElementById('load-more-btn').style.display = 'none';
            }
            
            // 检查缓存
            const cacheKey = `chart_${category}_${currentSearchOffset}`;
            if (apiCache.charts[cacheKey]) {
                console.log('📦 使用缓存的排行榜数据');
                if (loadMore) {
                    displaySongs([...currentSongs, ...apiCache.charts[cacheKey]], true);
                } else {
                    displaySongs(apiCache.charts[cacheKey]);
                }
                return;
            }
            
            // 模拟API延迟
            setTimeout(() => {
                try {
                    // 这里应该是实际的iTunes API调用
                    const chartSongs = generateChartSongs(category);
                    
                    // 缓存结果
                    apiCache.charts[cacheKey] = chartSongs;
                    
                    if (loadMore) {
                        displaySongs([...currentSongs, ...chartSongs], true);
                    } else {
                        displaySongs(chartSongs);
                    }
                    
                } catch (error) {
                    console.error('加载排行榜失败:', error);
                    showApiError();
                }
            }, 800);
        }
        
        function generateChartSongs(category) {
            const songs = [];
            let artists, genre;
            
            switch(category) {
                case 'chinese-pop':
                    artists = ['周杰伦', '林俊杰', '邓紫棋', '薛之谦', '毛不易'];
                    genre = '华语流行';
                    break;
                case 'western-pop':
                    artists = ['Taylor Swift', 'Ed Sheeran', 'Adele', 'Bruno Mars', 'Billie Eilish'];
                    genre = '欧美流行';
                    break;
                case 'chinese-dj':
                    artists = ['王绎龙', '杨小曼', '郑源', '祁隆', '庄心妍'];
                    genre = '中文DJ';
                    break;
                default:
                    artists = ['周杰伦', '林俊杰', '陈奕迅'];
                    genre = '华语流行';
            }
            
            for (let i = 0; i < 50; i++) {
                const artist = artists[Math.floor(Math.random() * artists.length)];
                songs.push({
                    id: Date.now() + i + (category === 'chinese-pop' ? 10000 : category === 'western-pop' ? 20000 : 30000),
                    title: `${genre}热门歌曲 ${i + 1}`,
                    artist: artist,
                    album: `${artist} ${genre}专辑`,
                    previewUrl: null
                });
            }
            
            return songs;
        }
        
        function getChartCategoryName(category) {
            const names = {
                'chinese-pop': '华语流行榜',
                'western-pop': '欧美流行榜',
                'chinese-dj': '中文DJ榜'
            };
            return names[category] || '排行榜';
        }

        // ==================== 歌曲显示功能 ====================
        function displaySongs(songs, append = false) {
            currentSongs = append ? [...currentSongs, ...songs] : songs;
            
            const songsContainer = document.getElementById('songs-container');
            
            if (!append) {
                songsContainer.innerHTML = '';
            }
            
            if (songs.length === 0) {
                songsContainer.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">🎵</div>
                        <div class="empty-state-message">未找到相关歌曲</div>
                        <div class="empty-state-submessage">请尝试其他搜索词</div>
                    </div>
                `;
                document.getElementById('load-more-btn').style.display = 'none';
                return;
            }
            
            songs.forEach(song => {
                const isInPlaylist = playlist.some(item => item.id === song.id);
                const songElement = document.createElement('div');
                songElement.className = 'song';
                songElement.innerHTML = `
                    <div class="song-info">
                        <div class="song-title">${song.title}</div>
                        <div class="song-artist">${song.artist}</div>
                        <div class="song-album">${song.album}</div>
                    </div>
                    <div class="song-controls">
                        ${song.previewUrl ? `
                            <button class="preview-btn ${currentlyPlayingId === song.id ? 'playing' : ''}" 
                                    data-song-id="${song.id}">
                                <span>${currentlyPlayingId === song.id ? '⏸️' : '▶️'}</span>
                                <span>${currentlyPlayingId === song.id ? '停止' : '试听'}</span>
                            </button>
                        ` : ''}
                        <button class="add-btn ${isInPlaylist ? 'disabled' : ''}" 
                                data-song-id="${song.id}"
                                ${isInPlaylist ? 'disabled' : ''}>
                            <span>${isInPlaylist ? '✅' : '➕'}</span>
                            <span>${isInPlaylist ? '已添加' : '添加'}</span>
                        </button>
                    </div>
                `;
                songsContainer.appendChild(songElement);
            });
            
            // 显示加载更多按钮（如果还有更多歌曲）
            if (songs.length >= 50) {
                document.getElementById('load-more-btn').style.display = 'flex';
            } else {
                document.getElementById('load-more-btn').style.display = 'none';
            }
        }
        
        function showNoResults(searchTerm) {
            const songsContainer = document.getElementById('songs-container');
            songsContainer.innerHTML = `
                <div class="empty-state">
                    <div class="empty-state-icon">🔍</div>
                    <div class="empty-state-message">未找到"${searchTerm}"的相关歌曲</div>
                    <div class="empty-state-submessage">请尝试其他搜索词或浏览排行榜</div>
                </div>
            `;
            document.getElementById('load-more-btn').style.display = 'none';
        }
        
        function showApiError() {
            const songsContainer = document.getElementById('songs-container');
            songsContainer.innerHTML = `
                <div class="error">
                    <div class="error-icon">❌</div>
                    <div class="error-message">iTunes连接不上，稍后再尝试</div>
                    <button class="nav-btn" onclick="loadChartOptimized(currentChartCategory)" 
                            style="margin-top: 15px; background: rgba(255,255,255,0.2);">
                        <span>🔄</span>
                        <span>重试</span>
                    </button>
                </div>
            `;
            document.getElementById('load-more-btn').style.display = 'none';
        }

        // ==================== 音频预览功能 ====================
        function togglePreview(songId) {
            const song = currentSongs.find(s => s.id == songId);
            if (!song) return;
            
            // 停止当前播放
            if (currentAudio) {
                currentAudio.pause();
                currentAudio = null;
            }
            
            // 如果点击的是正在播放的歌曲，停止播放
            if (currentlyPlayingId === songId) {
                currentlyPlayingId = null;
                updatePreviewButtons();
                return;
            }
            
            // 开始播放新歌曲
            currentlyPlayingId = songId;
            
            if (song.previewUrl) {
                currentAudio = new Audio(song.previewUrl);
                currentAudio.play();
                currentAudio.onended = function() {
                    currentlyPlayingId = null;
                    updatePreviewButtons();
                };
            }
            
            updatePreviewButtons();
        }
        
        function updatePreviewButtons() {
            document.querySelectorAll('.preview-btn').forEach(btn => {
                const songId = btn.dataset.songId;
                if (songId == currentlyPlayingId) {
                    btn.classList.add('playing');
                    btn.innerHTML = '<span>⏸️</span><span>停止</span>';
                } else {
                    btn.classList.remove('playing');
                    btn.innerHTML = '<span>▶️</span><span>试听</span>';
                }
            });
        }

        // ==================== 歌单管理功能 ====================
        function addToPlaylist(songId) {
            const song = currentSongs.find(s => s.id == songId);
            if (!song) return;
            
            // 检查是否已在歌单中
            if (playlist.some(item => item.id === song.id)) {
                showMessage('此歌曲已在歌单中', 'warning');
                return;
            }
            
            // 添加到歌单
            playlist.push({
                ...song,
                addedAt: new Date().toISOString()
            });
            
            // 更新UI
            updatePlaylistUI();
            savePlaylistToStorage();
            
            // 更新添加按钮状态
            updateAddButtons();
            
            showMessage(`已添加"${song.title}"到歌单`, 'success');
        }
        
        function removeFromPlaylist(songId) {
            const index = playlist.findIndex(item => item.id === songId);
            if (index === -1) return;
            
            const removedSong = playlist[index];
            playlist.splice(index, 1);
            
            // 更新UI
            updatePlaylistUI();
            savePlaylistToStorage();
            
            // 更新添加按钮状态
            updateAddButtons();
            
            showMessage(`已从歌单移除"${removedSong.title}"`, 'info');
        }
        
        function updatePlaylistUI() {
            const playlistCount = document.getElementById('playlist-count');
            const playlistItems = document.getElementById('playlist-items');
            const submitBtn = document.getElementById('submit-playlist-btn');
            const priceRecommendation = document.getElementById('price-recommendation');
            
            // 更新计数
            playlistCount.textContent = playlist.length;
            
            // 更新提交按钮状态
            submitBtn.disabled = playlist.length === 0;
            
            // 更新价格推荐显示
            if (playlist.length > 0) {
                priceRecommendation.style.display = 'block';
                updatePriceRecommendation();
            } else {
                priceRecommendation.style.display = 'none';
            }
            
            // 更新歌单项列表
            if (playlist.length === 0) {
                playlistItems.innerHTML = `
                    <div class="empty-playlist">
                        <div class="empty-playlist-icon">🎵</div>
                        <div class="empty-playlist-message">歌单为空</div>
                        <div class="empty-playlist-submessage">请从左侧添加歌曲到歌单</div>
                    </div>
                `;
                return;
            }
            
            playlistItems.innerHTML = '';
            playlist.forEach((song, index) => {
                const item = document.createElement('div');
                item.className = 'playlist-item';
                item.innerHTML = `
                    <div class="playlist-item-content">
                        <div class="song-number">${index + 1}</div>
                        <div class="playlist-item-info">
                            <div class="playlist-item-title">${song.title}</div>
                            <div class="playlist-item-artist">${song.artist}</div>
                        </div>
                    </div>
                    <button class="remove-btn" data-song-id="${song.id}">
                        ×
                    </button>
                `;
                playlistItems.appendChild(item);
            });
        }
        
        function updateAddButtons() {
            document.querySelectorAll('.add-btn').forEach(btn => {
                const songId = parseInt(btn.dataset.songId);
                const isInPlaylist = playlist.some(item => item.id === songId);
                
                if (isInPlaylist) {
                    btn.classList.add('disabled');
                    btn.disabled = true;
                    btn.innerHTML = '<span>✅</span><span>已添加</span>';
                } else {
                    btn.classList.remove('disabled');
                    btn.disabled = false;
                    btn.innerHTML = '<span>➕</span><span>添加</span>';
                }
            });
        }
        
        function updatePriceRecommendation() {
            const songCount = playlist.length;
            const shippingRegion = document.querySelector('input[name="shipping-region"]:checked').value;
            
            // 计算套餐价格
            let planName, planPrice;
            
            if (songCount <= 20) {
                planName = "基础版";
                planPrice = 29;
            } else if (songCount <= 50) {
                planName = "标准版";
                planPrice = 49;
            } else if (songCount <= 100) {
                planName = "进阶版";
                planPrice = 69;
            } else if (songCount <= 200) {
                planName = "豪华版";
                planPrice = 89;
            } else if (songCount <= 300) {
                planName = "专业版";
                planPrice = 109;
            } else if (songCount <= 400) {
                planName = "旗舰版";
                planPrice = 129;
            } else if (songCount <= 500) {
                planName = "至尊版";
                planPrice = 159;
            } else {
                planName = "自定义版";
                planPrice = songCount * 0.3;
            }
            
            // 计算配送费用
            const shippingCost = shippingRegion === 'east' ? 8 : 0;
            const totalPrice = planPrice + shippingCost;
            
            // 更新UI
            document.getElementById('recommended-plan-name').textContent = planName;
            document.getElementById('recommended-plan-price').textContent = `RM ${planPrice}`;
            document.getElementById('shipping-cost-text').textContent = 
                shippingRegion === 'east' ? 'RM 8 (东马)' : 'RM 0 (西马免费)';
            document.getElementById('total-price-text').textContent = `RM ${totalPrice}`;
        }
        
        function updateModalPrice() {
            const songCount = playlist.length;
            const shippingRegion = document.querySelector('input[name="shipping-region"]:checked').value;
            
            // 计算套餐价格
            let planPrice;
            
            if (songCount <= 20) planPrice = 29;
            else if (songCount <= 50) planPrice = 49;
            else if (songCount <= 100) planPrice = 69;
            else if (songCount <= 200) planPrice = 89;
            else if (songCount <= 300) planPrice = 109;
            else if (songCount <= 400) planPrice = 129;
            else if (songCount <= 500) planPrice = 159;
            else planPrice = songCount * 0.3;
            
            // 计算配送费用
            const shippingCost = shippingRegion === 'east' ? 8 : 0;
            const totalPrice = planPrice + shippingCost;
            
            // 更新模态框UI
            document.getElementById('modal-song-count').textContent = songCount;
            document.getElementById('modal-base-price').textContent = `套餐价格: RM ${planPrice}`;
            document.getElementById('modal-shipping-fee').textContent = 
                shippingRegion === 'east' ? `配送费用: RM ${shippingCost}` : '配送费用: 免费';
            document.getElementById('modal-total-price').textContent = `总金额: RM ${totalPrice}`;
        }

        // ==================== 本地存储功能 ====================
        function savePlaylistToStorage() {
            try {
                const playlistData = {
                    songs: playlist,
                    timestamp: new Date().toISOString()
                };
                
                if (currentUser) {
                    // 如果用户已登录，将用户ID包含在存储键中
                    localStorage.setItem(`playlist_${currentUser.uid}`, JSON.stringify(playlistData));
                } else {
                    // 未登录用户使用匿名存储
                    localStorage.setItem('playlist_anonymous', JSON.stringify(playlistData));
                }
                
                console.log('💾 歌单已保存到本地存储');
            } catch (error) {
                console.error('保存歌单到本地存储失败:', error);
            }
        }
        
        function restorePlaylistFromStorage() {
            try {
                let playlistData = null;
                
                if (currentUser) {
                    // 尝试从用户特定的存储中恢复
                    const userData = localStorage.getItem(`playlist_${currentUser.uid}`);
                    if (userData) {
                        playlistData = JSON.parse(userData);
                    }
                }
                
                // 如果用户没有数据，尝试从匿名存储恢复
                if (!playlistData) {
                    const anonymousData = localStorage.getItem('playlist_anonymous');
                    if (anonymousData) {
                        playlistData = JSON.parse(anonymousData);
                    }
                }
                
                if (playlistData && playlistData.songs) {
                    playlist = playlistData.songs;
                    updatePlaylistUI();
                    updateAddButtons();
                    console.log('📂 从本地存储恢复歌单:', playlist.length, '首歌曲');
                }
            } catch (error) {
                console.error('从本地存储恢复歌单失败:', error);
                playlist = []; // 重置为空数组
            }
        }
        
        function syncPlaylistWithUser() {
            if (!currentUser) return;
            
            try {
                // 检查是否有匿名歌单需要同步
                const anonymousData = localStorage.getItem('playlist_anonymous');
                if (anonymousData) {
                    const anonymousPlaylist = JSON.parse(anonymousData).songs || [];
                    
                    if (anonymousPlaylist.length > 0) {
                        // 合并歌单（去重）
                        const existingIds = new Set(playlist.map(song => song.id));
                        anonymousPlaylist.forEach(song => {
                            if (!existingIds.has(song.id)) {
                                playlist.push(song);
                                existingIds.add(song.id);
                            }
                        });
                        
                        // 更新UI和存储
                        updatePlaylistUI();
                        savePlaylistToStorage();
                        
                        // 清除匿名存储
                        localStorage.removeItem('playlist_anonymous');
                        
                        console.log('🔄 匿名歌单已同步到用户账号');
                    }
                }
            } catch (error) {
                console.error('同步歌单失败:', error);
            }
        }

        // ==================== 用户界面更新 ====================
        function updateUserUI() {
            const userInfo = document.getElementById('user-info');
            const loginBtn = document.getElementById('login-btn');
            const userAvatar = document.getElementById('user-avatar');
            const userEmail = document.getElementById('user-email');
            
            if (currentUser) {
                // 用户已登录
                userInfo.style.display = 'flex';
                loginBtn.style.display = 'none';
                
                // 更新用户信息
                const email = currentUser.email;
                userEmail.textContent = email;
                
                // 生成头像首字母
                const firstLetter = email.charAt(0).toUpperCase();
                userAvatar.textContent = firstLetter;
                
                // 显示我的订单按钮
                document.getElementById('my-orders-nav').style.display = 'block';
                
            } else {
                // 用户未登录
                userInfo.style.display = 'none';
                loginBtn.style.display = 'flex';
                
                // 隐藏我的订单按钮
                document.getElementById('my-orders-nav').style.display = 'none';
            }
        }

        // ==================== 登录功能 ====================
        function showEmailLoginForm() {
            // 这里可以实现邮箱登录表单
            // 暂时使用简单提示
            const email = prompt('请输入您的邮箱地址:');
            if (email) {
                const password = prompt('请输入密码:');
                if (password) {
                    signInWithEmail(email, password);
                }
            }
        }
        
        function signInWithEmail(email, password) {
            // 这里应该调用Firebase邮箱登录API
            // 暂时使用模拟登录
            showMessage('邮箱登录功能正在开发中', 'info');
        }
        
        function signInWithGoogle() {
            // 这里应该调用Firebase Google登录API
            // 暂时使用模拟登录
            showMessage('Google登录功能正在开发中', 'info');
        }

        // ==================== 订单提交功能 ====================
        function showSubmitPlaylistModal() {
            updateModalPrice();
            document.getElementById('submit-playlist-modal').style.display = 'flex';
        }
        
        function submitOrder() {
            if (!currentUser) {
                showMessage('请先登录', 'error');
                return;
            }
            
            if (playlist.length === 0) {
                showMessage('歌单为空', 'error');
                return;
            }
            
            // 验证表单
            if (!validateOrderForm()) {
                return;
            }
            
            // 显示加载状态
            const submitBtn = document.getElementById('submit-order-btn');
            const originalText = submitBtn.innerHTML;
            submitBtn.innerHTML = '<span>🔄</span><span>提交中...</span>';
            submitBtn.disabled = true;
            
            // 收集订单数据
            const orderData = {
                orderId: generateOrderId(),
                customerName: document.getElementById('customer-name').value,
                customerPhone: document.getElementById('customer-phone').value,
                customerEmail: document.getElementById('customer-email').value,
                address: {
                    street: document.getElementById('address-street').value,
                    city: document.getElementById('address-city').value,
                    state: document.getElementById('address-state').value,
                    zip: document.getElementById('address-zip').value
                },
                shippingRegion: document.querySelector('input[name="shipping-region"]:checked').value,
                note: document.getElementById('customer-note').value,
                songs: playlist,
                songCount: playlist.length,
                plan: getPlanForSongCount(playlist.length),
                totalPrice: calculateTotalPrice(),
                status: 'pending',
                createdAt: new Date().toISOString(),
                userId: currentUser.uid,
                userEmail: currentUser.email
            };
            
            // 模拟提交到Firebase
            setTimeout(() => {
                // 这里应该调用Firebase Firestore API保存订单
                console.log('📝 提交订单:', orderData);
                
                // 清空歌单
                playlist = [];
                updatePlaylistUI();
                savePlaylistToStorage();
                
                // 关闭模态框
                document.getElementById('submit-playlist-modal').style.display = 'none';
                
                // 重置按钮
                submitBtn.innerHTML = originalText;
                submitBtn.disabled = false;
                
                // 显示成功消息
                showMessage('订单提交成功！', 'success');
                
                // 清空表单
                document.getElementById('submit-playlist-form').reset();
                
                // 切换到我的订单页面
                showPage('my-orders');
                setActiveNav(document.getElementById('my-orders-nav'));
                loadMyOrders();
                
            }, 1500);
        }
        
        function validateOrderForm() {
            let isValid = true;
            
            // 清空所有错误消息
            document.querySelectorAll('.error-message').forEach(el => {
                el.textContent = '';
            });
            
            document.querySelectorAll('.form-input, .form-select').forEach(el => {
                el.classList.remove('error');
            });
            
            // 验证姓名
            const name = document.getElementById('customer-name').value.trim();
            if (!name) {
                document.getElementById('customer-name-error').textContent = '请输入姓名';
                document.getElementById('customer-name').classList.add('error');
                isValid = false;
            }
            
            // 验证电话
            const phone = document.getElementById('customer-phone').value.trim();
            const phoneRegex = /^(\+?6?01)[0-46-9]-*[0-9]{7,8}$/;
            if (!phoneRegex.test(phone)) {
                document.getElementById('customer-phone-error').textContent = '请输入有效的马来西亚电话号码';
                document.getElementById('customer-phone').classList.add('error');
                isValid = false;
            }
            
            // 验证邮箱
            const email = document.getElementById('customer-email').value.trim();
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            if (!emailRegex.test(email)) {
                document.getElementById('customer-email-error').textContent = '请输入有效的邮箱地址';
                document.getElementById('customer-email').classList.add('error');
                isValid = false;
            }
            
            // 验证地址
            const addressFields = ['address-street', 'address-city', 'address-state', 'address-zip'];
            addressFields.forEach(fieldId => {
                const field = document.getElementById(fieldId);
                if (!field.value.trim()) {
                    document.getElementById(`${fieldId}-error`).textContent = '此字段不能为空';
                    field.classList.add('error');
                    isValid = false;
                }
            });
            
            return isValid;
        }
        
        function generateOrderId() {
            const timestamp = Date.now();
            const random = Math.floor(Math.random() * 1000);
            return `ORD-${timestamp}-${random}`;
        }
        
        function getPlanForSongCount(count) {
            if (count <= 20) return 'basic';
            if (count <= 50) return 'standard';
            if (count <= 100) return 'premium';
            if (count <= 200) return 'deluxe';
            if (count <= 300) return 'professional';
            if (count <= 400) return 'flagship';
            if (count <= 500) return 'ultimate';
            return 'custom';
        }
        
        function calculateTotalPrice() {
            const songCount = playlist.length;
            const shippingRegion = document.querySelector('input[name="shipping-region"]:checked').value;
            
            let planPrice;
            if (songCount <= 20) planPrice = 29;
            else if (songCount <= 50) planPrice = 49;
            else if (songCount <= 100) planPrice = 69;
            else if (songCount <= 200) planPrice = 89;
            else if (songCount <= 300) planPrice = 109;
            else if (songCount <= 400) planPrice = 129;
            else if (songCount <= 500) planPrice = 159;
            else planPrice = songCount * 0.3;
            
            const shippingCost = shippingRegion === 'east' ? 8 : 0;
            return planPrice + shippingCost;
        }

        // ==================== 订单管理功能 ====================
        function loadOrders() {
            if (!isAdmin) return;
            
            // 显示加载状态
            const tableBody = document.getElementById('orders-table-body');
            tableBody.innerHTML = `
                <tr>
                    <td colspan="10" style="text-align: center; padding: 60px;">
                        <div class="loading">
                            <div class="loading-spinner"></div>
                            <div>正在加载订单数据...</div>
                        </div>
                    </td>
                </tr>
            `;
            
            // 模拟从Firebase加载订单
            setTimeout(() => {
                // 这里应该调用Firebase Firestore API获取订单
                orders = generateMockOrders(50);
                renderOrdersTable();
                updateStatsCards();
                renderPagination('orders', 1, Math.ceil(orders.length / 20));
                
                console.log('📋 加载订单:', orders.length, '条记录');
            }, 1000);
        }
        
        function loadMyOrders() {
            if (!currentUser) return;
            
            // 显示加载状态
            const tableBody = document.getElementById('my-orders-table-body');
            tableBody.innerHTML = `
                <tr>
                    <td colspan="8" style="text-align: center; padding: 60px;">
                        <div class="loading">
                            <div class="loading-spinner"></div>
                            <div>正在加载订单数据...</div>
                        </div>
                    </td>
                </tr>
            `;
            
            // 模拟从Firebase加载用户订单
            setTimeout(() => {
                // 这里应该调用Firebase Firestore API获取用户订单
                myOrders = generateMockOrders(15).filter(order => 
                    order.userEmail === currentUser.email
                );
                renderMyOrdersTable();
                renderPagination('my-orders', 1, Math.ceil(myOrders.length / 10));
                
                console.log('📋 加载我的订单:', myOrders.length, '条记录');
            }, 1000);
        }
        
        function generateMockOrders(count) {
            const orders = [];
            const customers = ['张三', '李四', '王五', '赵六', '钱七'];
            const plans = ['basic', 'standard', 'premium', 'deluxe', 'professional'];
            const statuses = ['pending', 'paid', 'shipped', 'completed', 'cancelled'];
            const regions = ['west', 'east'];
            
            for (let i = 0; i < count; i++) {
                const songCount = Math.floor(Math.random() * 500) + 1;
                const plan = getPlanForSongCount(songCount);
                const region = regions[Math.floor(Math.random() * regions.length)];
                const price = calculateMockPrice(songCount, region);
                
                orders.push({
                    id: `ORD-${Date.now()}-${i}`,
                    orderId: `ORD-${1000 + i}`,
                    customerName: customers[Math.floor(Math.random() * customers.length)],
                    customerEmail: `user${i}@example.com`,
                    plan: plan,
                    songCount: songCount,
                    totalPrice: price,
                    shippingRegion: region,
                    status: statuses[Math.floor(Math.random() * statuses.length)],
                    createdAt: new Date(Date.now() - Math.random() * 30 * 24 * 60 * 60 * 1000).toISOString(),
                    userId: `user_${i}`,
                    userEmail: `user${i}@example.com`,
                    songs: generateMockSongs('歌曲', Math.min(songCount, 10), 'order')
                });
            }
            
            return orders;
        }
        
        function calculateMockPrice(songCount, region) {
            let price;
            if (songCount <= 20) price = 29;
            else if (songCount <= 50) price = 49;
            else if (songCount <= 100) price = 69;
            else if (songCount <= 200) price = 89;
            else if (songCount <= 300) price = 109;
            else if (songCount <= 400) price = 129;
            else if (songCount <= 500) price = 159;
            else price = songCount * 0.3;
            
            if (region === 'east') price += 8;
            return price;
        }
        
        function renderOrdersTable(page = 1) {
            const tableBody = document.getElementById('orders-table-body');
            const pageSize = 20;
            const start = (page - 1) * pageSize;
            const end = start + pageSize;
            const pageOrders = orders.slice(start, end);
            
            if (pageOrders.length === 0) {
                tableBody.innerHTML = `
                    <tr>
                        <td colspan="10" style="text-align: center; padding: 60px;">
                            <div class="empty-state">
                                <div class="empty-state-icon">📋</div>
                                <div class="empty-state-message">暂无订单数据</div>
                            </div>
                        </td>
                    </tr>
                `;
                return;
            }
            
            tableBody.innerHTML = '';
            pageOrders.forEach(order => {
                const isSelected = selectedOrders.has(order.id);
                const statusClass = getStatusClass(order.status);
                const statusText = getStatusText(order.status);
                const regionText = order.shippingRegion === 'east' ? '东马' : '西马';
                
                const row = document.createElement('tr');
                row.className = isSelected ? 'selected' : '';
                row.innerHTML = `
                    <td class="select-checkbox">
                        <input type="checkbox" class="order-checkbox" 
                               data-order-id="${order.id}" ${isSelected ? 'checked' : ''}>
                    </td>
                    <td>${order.orderId}</td>
                    <td>${order.customerName}</td>
                    <td>${getPlanText(order.plan)}</td>
                    <td>${order.songCount}</td>
                    <td>RM ${order.totalPrice.toFixed(2)}</td>
                    <td>${regionText}</td>
                    <td>
                        <span class="status-badge ${statusClass}">
                            <span>${getStatusIcon(order.status)}</span>
                            <span>${statusText}</span>
                        </span>
                    </td>
                    <td>${formatDate(order.createdAt)}</td>
                    <td>
                        <div class="action-buttons">
                            <button class="action-btn view-btn" data-order-id="${order.id}">
                                <span>👁️</span>
                                <span>查看</span>
                            </button>
                            <button class="action-btn edit-btn" data-order-id="${order.id}">
                                <span>✏️</span>
                                <span>编辑</span>
                            </button>
                            <button class="action-btn delete-btn" data-order-id="${order.id}">
                                <span>🗑️</span>
                                <span>删除</span>
                            </button>
                        </div>
                    </td>
                `;
                tableBody.appendChild(row);
            });
        }
        
        function renderMyOrdersTable(page = 1) {
            const tableBody = document.getElementById('my-orders-table-body');
            const pageSize = 10;
            const start = (page - 1) * pageSize;
            const end = start + pageSize;
            const pageOrders = myOrders.slice(start, end);
            
            if (pageOrders.length === 0) {
                tableBody.innerHTML = `
                    <tr>
                        <td colspan="8" style="text-align: center; padding: 60px;">
                            <div class="empty-state">
                                <div class="empty-state-icon">📋</div>
                                <div class="empty-state-message">您还没有任何订单</div>
                                <div class="empty-state-submessage">快去创建您的第一个歌单吧！</div>
                            </div>
                        </td>
                    </tr>
                `;
                return;
            }
            
            tableBody.innerHTML = '';
            pageOrders.forEach(order => {
                const statusClass = getStatusClass(order.status);
                const statusText = getStatusText(order.status);
                const regionText = order.shippingRegion === 'east' ? '东马' : '西马';
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${order.orderId}</td>
                    <td>${getPlanText(order.plan)}</td>
                    <td>${order.songCount}</td>
                    <td>RM ${order.totalPrice.toFixed(2)}</td>
                    <td>${regionText}</td>
                    <td>
                        <span class="status-badge ${statusClass}">
                            <span>${getStatusIcon(order.status)}</span>
                            <span>${statusText}</span>
                        </span>
                    </td>
                    <td>${formatDate(order.createdAt)}</td>
                    <td>
                        <button class="action-btn view-btn" data-order-id="${order.id}">
                            <span>👁️</span>
                            <span>查看</span>
                        </button>
                    </td>
                `;
                tableBody.appendChild(row);
            });
        }
        
        function getStatusClass(status) {
            switch(status) {
                case 'pending': return 'status-pending';
                case 'paid': return 'status-paid';
                case 'shipped': return 'status-shipped';
                case 'completed': return 'status-completed';
                case 'cancelled': return 'status-cancelled';
                case 'deleted': return 'status-deleted';
                default: return 'status-pending';
            }
        }
        
        function getStatusText(status) {
            switch(status) {
                case 'pending': return '待付款';
                case 'paid': return '已付款';
                case 'shipped': return '已发货';
                case 'completed': return '已完成';
                case 'cancelled': return '已取消';
                case 'deleted': return '已删除';
                default: return '待付款';
            }
        }
        
        function getStatusIcon(status) {
            switch(status) {
                case 'pending': return '⏳';
                case 'paid': return '💰';
                case 'shipped': return '🚚';
                case 'completed': return '✅';
                case 'cancelled': return '❌';
                case 'deleted': return '🗑️';
                default: return '⏳';
            }
        }
        
        function getPlanText(plan) {
            switch(plan) {
                case 'basic': return '基础版';
                case 'standard': return '标准版';
                case 'premium': return '进阶版';
                case 'deluxe': return '豪华版';
                case 'professional': return '专业版';
                case 'flagship': return '旗舰版';
                case 'ultimate': return '至尊版';
                case 'custom': return '自定义版';
                default: return '基础版';
            }
        }
        
        function formatDate(dateString) {
            const date = new Date(dateString);
            return date.toLocaleDateString('zh-CN', {
                year: 'numeric',
                month: '2-digit',
                day: '2-digit',
                hour: '2-digit',
                minute: '2-digit'
            });
        }

        // ==================== 分页功能 ====================
        function initPagination() {
            // 初始化分页管理器
            ordersPagination = {
                currentPage: 1,
                pageSize: 20,
                totalItems: 0,
                totalPages: 0
            };
            
            myOrdersPagination = {
                currentPage: 1,
                pageSize: 10,
                totalItems: 0,
                totalPages: 0
            };
        }
        
        function renderPagination(type, currentPage, totalPages) {
            const paginationId = type === 'orders' ? 'orders-pagination' : 'my-orders-pagination';
            const paginationBottomId = type === 'orders' ? 'orders-pagination-bottom' : 'my-orders-pagination-bottom';
            
            const paginationContainer = document.getElementById(paginationId);
            const paginationBottomContainer = document.getElementById(paginationBottomId);
            
            if (totalPages <= 1) {
                paginationContainer.innerHTML = '';
                paginationBottomContainer.innerHTML = '';
                return;
            }
            
            const paginationHTML = createPaginationHTML(type, currentPage, totalPages);
            paginationContainer.innerHTML = paginationHTML;
            paginationBottomContainer.innerHTML = paginationHTML;
            
            // 添加分页按钮事件
            document.querySelectorAll(`.pagination-btn[data-type="${type}"]`).forEach(btn => {
                btn.addEventListener('click', function() {
                    const page = parseInt(this.dataset.page);
                    if (page && !this.disabled) {
                        if (type === 'orders') {
                            ordersPagination.currentPage = page;
                            renderOrdersTable(page);
                        } else {
                            myOrdersPagination.currentPage = page;
                            renderMyOrdersTable(page);
                        }
                        updatePaginationButtons(type, page, totalPages);
                    }
                });
            });
        }
        
        function createPaginationHTML(type, currentPage, totalPages) {
            let html = '';
            
            // 上一页按钮
            html += `
                <button class="pagination-btn" data-type="${type}" data-page="${currentPage - 1}" 
                        ${currentPage === 1 ? 'disabled' : ''}>
                    ← 上一页
                </button>
            `;
            
            // 页码按钮
            const maxVisiblePages = 5;
            let startPage = Math.max(1, currentPage - Math.floor(maxVisiblePages / 2));
            let endPage = Math.min(totalPages, startPage + maxVisiblePages - 1);
            
            if (endPage - startPage + 1 < maxVisiblePages) {
                startPage = Math.max(1, endPage - maxVisiblePages + 1);
            }
            
            if (startPage > 1) {
                html += `<button class="pagination-btn" data-type="${type}" data-page="1">1</button>`;
                if (startPage > 2) {
                    html += `<span class="page-info">...</span>`;
                }
            }
            
            for (let i = startPage; i <= endPage; i++) {
                html += `
                    <button class="pagination-btn ${i === currentPage ? 'active' : ''}" 
                            data-type="${type}" data-page="${i}">
                        ${i}
                    </button>
                `;
            }
            
            if (endPage < totalPages) {
                if (endPage < totalPages - 1) {
                    html += `<span class="page-info">...</span>`;
                }
                html += `<button class="pagination-btn" data-type="${type}" data-page="${totalPages}">${totalPages}</button>`;
            }
            
            // 下一页按钮
            html += `
                <button class="pagination-btn" data-type="${type}" data-page="${currentPage + 1}" 
                        ${currentPage === totalPages ? 'disabled' : ''}>
                    下一页 →
                </button>
            `;
            
            // 页面信息
            html += `
                <span class="page-info">
                    第 ${currentPage} 页 / 共 ${totalPages} 页
                </span>
            `;
            
            return html;
        }
        
        function updatePaginationButtons(type, currentPage, totalPages) {
            document.querySelectorAll(`.pagination-btn[data-type="${type}"]`).forEach(btn => {
                const page = parseInt(btn.dataset.page);
                
                // 更新活动状态
                if (page === currentPage) {
                    btn.classList.add('active');
                } else {
                    btn.classList.remove('active');
                }
                
                // 更新禁用状态
                if (page < 1 || page > totalPages) {
                    btn.disabled = true;
                } else {
                    btn.disabled = false;
                }
            });
            
            // 更新页面信息
            document.querySelectorAll(`.page-info[data-type="${type}"]`).forEach(span => {
                span.textContent = `第 ${currentPage} 页 / 共 ${totalPages} 页`;
            });
        }

        // ==================== 统计卡片更新 ====================
        function updateStatsCards() {
            if (orders.length === 0) return;
            
            const totalOrders = orders.length;
            const totalRevenue = orders.reduce((sum, order) => sum + order.totalPrice, 0);
            const avgOrder = totalRevenue / totalOrders;
            const totalSongs = orders.reduce((sum, order) => sum + order.songCount, 0);
            
            document.getElementById('stat-total-orders').textContent = totalOrders;
            document.getElementById('stat-total-revenue').textContent = `RM ${totalRevenue.toFixed(2)}`;
            document.getElementById('stat-avg-order').textContent = `RM ${avgOrder.toFixed(2)}`;
            document.getElementById('stat-total-songs').textContent = totalSongs;
        }

        // ==================== 订单详情功能 ====================
        function viewOrderDetails(orderId) {
            const order = [...orders, ...myOrders].find(o => o.id === orderId);
            if (!order) {
                showMessage('订单不存在', 'error');
                return;
            }
            
            const modalContent = document.getElementById('order-details-content');
            const regionText = order.shippingRegion === 'east' ? '东马 (+RM 8.00)' : '西马 (免费)';
            const statusClass = getStatusClass(order.status);
            const statusText = getStatusText(order.status);
            
            // 构建歌曲列表文本（按照规格要求）
            let songsText = '订单号：' + order.orderId + '\n';
            songsText += '歌曲列表：\n';
            (order.songs || []).forEach((song, index) => {
                songsText += `${index + 1}. ${song.title} - ${song.artist} (专辑：${song.album})\n`;
            });
            
            modalContent.innerHTML = `
                <div class="order-details-grid">
                    <div class="detail-card">
                        <h4>👤 顾客信息</h4>
                        <div class="detail-item">
                            <span class="detail-label">姓名</span>
                            <span class="detail-value">${order.customerName}</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">邮箱</span>
                            <span class="detail-value">${order.customerEmail}</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">电话</span>
                            <span class="detail-value">${order.customerPhone || '未提供'}</span>
                        </div>
                    </div>
                    
                    <div class="detail-card">
                        <h4>📦 订单信息</h4>
                        <div class="detail-item">
                            <span class="detail-label">订单号</span>
                            <span class="detail-value">${order.orderId}</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">套餐</span>
                            <span class="detail-value">${getPlanText(order.plan)}</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">歌曲数量</span>
                            <span class="detail-value">${order.songCount} 首</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">总金额</span>
                            <span class="detail-value">RM ${order.totalPrice.toFixed(2)}</span>
                        </div>
                    </div>
                    
                    <div class="detail-card">
                        <h4>🚚 配送信息</h4>
                        <div class="detail-item">
                            <span class="detail-label">地区</span>
                            <span class="detail-value">${regionText}</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">地址</span>
                            <span class="detail-value">${order.address ? 
                                `${order.address.street}, ${order.address.city}, ${order.address.state} ${order.address.zip}` : 
                                '未提供'}</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">状态</span>
                            <span class="detail-value">
                                <span class="status-badge ${statusClass}">${statusText}</span>
                            </span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">创建时间</span>
                            <span class="detail-value">${formatDate(order.createdAt)}</span>
                        </div>
                    </div>
                </div>
                
                <div class="detail-card">
                    <h4>🎵 歌曲列表</h4>
                    <div class="songs-list-container">
                        ${(order.songs || []).map((song, index) => `
                            <div class="song-detail-item">
                                <div class="song-detail-title">${index + 1}. ${song.title}</div>
                                <div class="song-detail-artist">${song.artist}</div>
                                <div class="song-detail-album">${song.album}</div>
                            </div>
                        `).join('')}
                    </div>
                </div>
                
                ${isAdmin ? `
                    <div class="status-update-form">
                        <h4>🔄 更新订单状态</h4>
                        <div class="status-update-row">
                            <select class="status-select" id="order-status-select">
                                <option value="pending" ${order.status === 'pending' ? 'selected' : ''}>待付款</option>
                                <option value="paid" ${order.status === 'paid' ? 'selected' : ''}>已付款</option>
                                <option value="shipped" ${order.status === 'shipped' ? 'selected' : ''}>已发货</option>
                                <option value="completed" ${order.status === 'completed' ? 'selected' : ''}>已完成</option>
                                <option value="cancelled" ${order.status === 'cancelled' ? 'selected' : ''}>已取消</option>
                            </select>
                            <button class="status-update-btn" onclick="updateOrderStatus('${order.id}')">
                                <span>🔄</span>
                                <span>更新状态</span>
                            </button>
                        </div>
                    </div>
                ` : ''}
                
                <div class="order-actions">
                    <button class="action-btn view-btn" onclick="copyOrderDetails('${orderId}')">
                        <span>📋</span>
                        <span>复制详情</span>
                    </button>
                    ${isAdmin ? `
                        <button class="action-btn edit-btn" onclick="editOrder('${order.id}')">
                            <span>✏️</span>
                            <span>编辑订单</span>
                        </button>
                    ` : ''}
                </div>
                
                <textarea id="order-details-text" style="display: none;">${songsText}</textarea>
            `;
            
            document.getElementById('order-details-modal').style.display = 'flex';
        }
        
        function copyOrderDetails(orderId) {
            const textarea = document.getElementById('order-details-text');
            if (!textarea) return;
            
            textarea.style.display = 'block';
            textarea.select();
            textarea.setSelectionRange(0, 99999);
            
            try {
                document.execCommand('copy');
                showMessage('订单详情已复制到剪贴板', 'success');
            } catch (err) {
                showMessage('复制失败，请手动复制', 'error');
            }
            
            textarea.style.display = 'none';
        }
        
        function updateOrderStatus(orderId) {
            const newStatus = document.getElementById('order-status-select').value;
            
            // 这里应该调用Firebase API更新订单状态
            const order = orders.find(o => o.id === orderId);
            if (order) {
                order.status = newStatus;
                showMessage('订单状态已更新', 'success');
                
                // 重新渲染表格
                renderOrdersTable(ordersPagination.currentPage);
                
                // 关闭模态框
                document.getElementById('order-details-modal').style.display = 'none';
            }
        }
        
        function editOrder(orderId) {
            showMessage('编辑订单功能正在开发中', 'info');
        }
        
        function deleteOrder(orderId) {
            if (!confirm('确定要删除这个订单吗？此操作不可撤销。')) {
                return;
            }
            
            // 这里应该调用Firebase API删除订单
            const index = orders.findIndex(o => o.id === orderId);
            if (index !== -1) {
                orders.splice(index, 1);
                showMessage('订单已删除', 'success');
                
                // 重新渲染表格
                renderOrdersTable(ordersPagination.currentPage);
                updateStatsCards();
            }
        }

        // ==================== 批量操作功能 ====================
        function toggleOrderSelection(orderId, isSelected) {
            if (isSelected) {
                selectedOrders.add(orderId);
            } else {
                selectedOrders.delete(orderId);
            }
            
            // 更新全选复选框状态
            const totalCheckboxes = document.querySelectorAll('.order-checkbox').length;
            const checkedCheckboxes = document.querySelectorAll('.order-checkbox:checked').length;
            document.getElementById('select-all-checkbox').checked = 
                totalCheckboxes > 0 && checkedCheckboxes === totalCheckboxes;
            
            updateBatchPanel();
        }
        
        function updateBatchPanel() {
            const batchPanel = document.getElementById('batch-panel');
            const batchSelectedCount = document.getElementById('batch-selected-count');
            const batchBtn = document.getElementById('batch-operations-btn');
            
            batchSelectedCount.textContent = selectedOrders.size;
            
            if (selectedOrders.size > 0) {
                batchPanel.classList.add('show');
                batchBtn.style.display = 'flex';
            } else {
                batchPanel.classList.remove('show');
                if (document.querySelectorAll('.order-checkbox').length === 0) {
                    batchBtn.style.display = 'none';
                }
            }
        }
        
        function clearSelectedOrders() {
            selectedOrders.clear();
            document.querySelectorAll('.order-checkbox').forEach(checkbox => {
                checkbox.checked = false;
            });
            document.getElementById('select-all-checkbox').checked = false;
            updateBatchPanel();
        }
        
        function showBatchOperationsModal() {
            if (selectedOrders.size === 0) {
                showMessage('请先选择订单', 'warning');
                return;
            }
            
            const modalContent = document.getElementById('batch-operations-content');
            const selectedOrderList = Array.from(selectedOrders).slice(0, 10); // 只显示前10个
            
            modalContent.innerHTML = `
                <div class="batch-status-form">
                    <h3>批量更新订单状态</h3>
                    <p>已选择 ${selectedOrders.size} 个订单</p>
                    
                    <div class="selected-orders-list">
                        ${selectedOrderList.map(orderId => {
                            const order = orders.find(o => o.id === orderId);
                            return order ? `
                                <div class="selected-order-item">
                                    <span>${order.orderId} - ${order.customerName}</span>
                                    <span class="status-badge ${getStatusClass(order.status)}">
                                        ${getStatusText(order.status)}
                                    </span>
                                </div>
                            ` : '';
                        }).join('')}
                        ${selectedOrders.size > 10 ? `<div style="text-align: center; opacity: 0.7;">... 还有 ${selectedOrders.size - 10} 个订单</div>` : ''}
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">新状态</label>
                        <select class="form-select" id="batch-new-status">
                            <option value="pending">待付款</option>
                            <option value="paid">已付款</option>
                            <option value="shipped">已发货</option>
                            <option value="completed">已完成</option>
                            <option value="cancelled">已取消</option>
                            <option value="deleted">已删除</option>
                        </select>
                    </div>
                    
                    <button class="form-submit-btn" onclick="processBatchStatusUpdate()">
                        <span>🔄</span>
                        <span>批量更新状态</span>
                    </button>
                </div>
            `;
            
            document.getElementById('batch-operations-modal').style.display = 'flex';
        }
        
        function processBatchStatusUpdate() {
            const newStatus = document.getElementById('batch-new-status').value;
            
            // 这里应该调用Firebase API批量更新订单状态
            selectedOrders.forEach(orderId => {
                const order = orders.find(o => o.id === orderId);
                if (order) {
                    order.status = newStatus;
                }
            });
            
            showMessage(`已更新 ${selectedOrders.size} 个订单的状态`, 'success');
            clearSelectedOrders();
            renderOrdersTable(ordersPagination.currentPage);
            document.getElementById('batch-operations-modal').style.display = 'none';
        }
        
        function batchExportOrders() {
            if (selectedOrders.size === 0) {
                showMessage('请先选择订单', 'warning');
                return;
            }
            
            const selectedOrdersData = orders.filter(order => selectedOrders.has(order.id));
            exportOrdersToExcel(selectedOrdersData, 'selected_orders');
        }
        
        function batchDeleteOrders() {
            if (selectedOrders.size === 0) {
                showMessage('请先选择订单', 'warning');
                return;
            }
            
            if (!confirm(`确定要删除选中的 ${selectedOrders.size} 个订单吗？此操作不可撤销。`)) {
                return;
            }
            
            // 这里应该调用Firebase API批量删除订单
            selectedOrders.forEach(orderId => {
                const index = orders.findIndex(o => o.id === orderId);
                if (index !== -1) {
                    orders.splice(index, 1);
                }
            });
            
            showMessage(`已删除 ${selectedOrders.size} 个订单`, 'success');
            clearSelectedOrders();
            renderOrdersTable(ordersPagination.currentPage);
            updateStatsCards();
        }

        // ==================== Excel导出功能 ====================
        function exportOrdersToExcel(ordersToExport = null, filename = 'orders') {
            const data = ordersToExport || orders;
            
            if (data.length === 0) {
                showMessage('没有可导出的订单数据', 'warning');
                return;
            }
            
            try {
                // 准备数据
                const worksheetData = [
                    ['订单号', '顾客姓名', '套餐类型', '歌曲数量', '总金额', '配送地区', '订单状态', '创建时间', '顾客邮箱', '歌曲列表']
                ];
                
                data.forEach(order => {
                    // 构建歌曲列表文本（按照规格要求）
                    let songsText = '订单号：' + order.orderId + '\n';
                    songsText += '歌曲列表：\n';
                    (order.songs || []).forEach((song, index) => {
                        songsText += `${index + 1}. ${song.title} - ${song.artist} (专辑：${song.album})\n`;
                    });
                    
                    worksheetData.push([
                        order.orderId,
                        order.customerName,
                        getPlanText(order.plan),
                        order.songCount,
                        `RM ${order.totalPrice.toFixed(2)}`,
                        order.shippingRegion === 'east' ? '东马' : '西马',
                        getStatusText(order.status),
                        formatDate(order.createdAt),
                        order.customerEmail || '',
                        songsText
                    ]);
                });
                
                // 创建工作簿和工作表
                const workbook = XLSX.utils.book_new();
                const worksheet = XLSX.utils.aoa_to_sheet(worksheetData);
                
                // 设置列宽
                const colWidths = [
                    { wch: 15 }, // 订单号
                    { wch: 12 }, // 顾客姓名
                    { wch: 10 }, // 套餐类型
                    { wch: 10 }, // 歌曲数量
                    { wch: 12 }, // 总金额
                    { wch: 10 }, // 配送地区
                    { wch: 10 }, // 订单状态
                    { wch: 20 }, // 创建时间
                    { wch: 25 }, // 顾客邮箱
                    { wch: 50 }  // 歌曲列表
                ];
                worksheet['!cols'] = colWidths;
                
                // 添加到工作簿
                XLSX.utils.book_append_sheet(workbook, worksheet, '订单数据');
                
                // 创建歌单详情工作表（按照规格要求）
                const playlistWorksheetData = [
                    ['订单号', '歌曲详情']
                ];
                
                data.forEach(order => {
                    let songsText = '';
                    (order.songs || []).forEach((song, index) => {
                        songsText += `${index + 1}. ${song.title} - ${song.artist} (专辑：${song.album})\n`;
                    });
                    
                    playlistWorksheetData.push([
                        order.orderId,
                        songsText
                    ]);
                });
                
                const playlistWorksheet = XLSX.utils.aoa_to_sheet(playlistWorksheetData);
                const playlistColWidths = [
                    { wch: 15 }, // 订单号
                    { wch: 80 }  // 歌曲详情
                ];
                playlistWorksheet['!cols'] = playlistColWidths;
                XLSX.utils.book_append_sheet(workbook, playlistWorksheet, '歌单详情');
                
                // 导出文件
                const excelBuffer = XLSX.write(workbook, { bookType: 'xlsx', type: 'array' });
                const blob = new Blob([excelBuffer], { type: 'application/octet-stream' });
                const url = URL.createObjectURL(blob);
                const link = document.createElement('a');
                link.href = url;
                link.download = `${filename}_${new Date().toISOString().slice(0, 10)}.xlsx`;
                link.click();
                URL.revokeObjectURL(url);
                
                showMessage(`已导出 ${data.length} 个订单到Excel文件`, 'success');
                
            } catch (error) {
                console.error('导出Excel失败:', error);
                showMessage('导出失败，请重试', 'error');
            }
        }

        // ==================== 筛选功能 ====================
        function applyFilters() {
            const status = document.getElementById('filter-status').value;
            const customerName = document.getElementById('filter-customer-name').value.trim();
            const startDate = document.getElementById('filter-start-date').value;
            const endDate = document.getElementById('filter-end-date').value;
            
            let filteredOrders = [...orders];
            
            // 状态筛选
            if (status !== 'all') {
                filteredOrders = filteredOrders.filter(order => order.status === status);
            }
            
            // 顾客姓名筛选
            if (customerName) {
                filteredOrders = filteredOrders.filter(order => 
                    order.customerName.toLowerCase().includes(customerName.toLowerCase())
                );
            }
            
            // 日期筛选
            if (startDate) {
                const start = new Date(startDate);
                filteredOrders = filteredOrders.filter(order => 
                    new Date(order.createdAt) >= start
                );
            }
            
            if (endDate) {
                const end = new Date(endDate);
                end.setHours(23, 59, 59, 999);
                filteredOrders = filteredOrders.filter(order => 
                    new Date(order.createdAt) <= end
                );
            }
            
            // 更新显示
            const tempOrders = orders;
            orders = filteredOrders;
            renderOrdersTable(1);
            renderPagination('orders', 1, Math.ceil(filteredOrders.length / 20));
            orders = tempOrders; // 恢复原数据
            
            showMessage(`筛选到 ${filteredOrders.length} 个订单`, 'info');
        }
        
        function clearFilters() {
            document.getElementById('filter-status').value = 'all';
            document.getElementById('filter-customer-name').value = '';
            document.getElementById('filter-start-date').value = '';
            document.getElementById('filter-end-date').value = '';
            
            renderOrdersTable(1);
            renderPagination('orders', 1, Math.ceil(orders.length / 20));
            
            showMessage('筛选条件已清除', 'info');
        }
        
        function applyMyOrdersFilters() {
            const status = document.getElementById('my-orders-filter-status').value;
            const startDate = document.getElementById('my-orders-filter-start-date').value;
            const endDate = document.getElementById('my-orders-filter-end-date').value;
            
            let filteredOrders = [...myOrders];
            
            // 状态筛选
            if (status !== 'all') {
                filteredOrders = filteredOrders.filter(order => order.status === status);
            }
            
            // 日期筛选
            if (startDate) {
                const start = new Date(startDate);
                filteredOrders = filteredOrders.filter(order => 
                    new Date(order.createdAt) >= start
                );
            }
            
            if (endDate) {
                const end = new Date(endDate);
                end.setHours(23, 59, 59, 999);
                filteredOrders = filteredOrders.filter(order => 
                    new Date(order.createdAt) <= end
                );
            }
            
            // 更新显示
            const tempOrders = myOrders;
            myOrders = filteredOrders;
            renderMyOrdersTable(1);
            renderPagination('my-orders', 1, Math.ceil(filteredOrders.length / 10));
            myOrders = tempOrders; // 恢复原数据
            
            showMessage(`筛选到 ${filteredOrders.length} 个订单`, 'info');
        }
        
        function clearMyOrdersFilters() {
            document.getElementById('my-orders-filter-status').value = 'all';
            document.getElementById('my-orders-filter-start-date').value = '';
            document.getElementById('my-orders-filter-end-date').value = '';
            
            renderMyOrdersTable(1);
            renderPagination('my-orders', 1, Math.ceil(myOrders.length / 10));
            
            showMessage('筛选条件已清除', 'info');
        }

        // ==================== 价格配套选择 ====================
        function handlePlanSelection(plan) {
            const planNames = {
                basic: '基础版',
                standard: '标准版',
                premium: '进阶版',
                deluxe: '豪华版',
                professional: '专业版',
                flagship: '旗舰版',
                ultimate: '至尊版',
                custom: '自定义版'
            };
            
            const message = plan === 'custom' 
                ? '请联系客服进行自定义套餐咨询' 
                : `已选择${planNames[plan]}套餐`;
            
            showMessage(message, 'info');
            
            // 切换到点歌系统页面
            showPage('karaoke');
            setActiveNav(document.getElementById('karaoke-nav'));
        }

        // ==================== 消息通知功能 ====================
        function showMessage(message, type = 'info') {
            // 移除现有消息
            const existingMessage = document.querySelector('.message-notification');
            if (existingMessage) {
                existingMessage.remove();
            }
            
            // 创建新消息
            const messageDiv = document.createElement('div');
            messageDiv.className = `message-notification`;
            
            // 设置消息样式
            let backgroundColor, icon;
            switch(type) {
                case 'success':
                    backgroundColor = 'rgba(46, 204, 113, 0.9)';
                    icon = '✅';
                    break;
                case 'error':
                    backgroundColor = 'rgba(231, 76, 60, 0.9)';
                    icon = '❌';
                    break;
                case 'warning':
                    backgroundColor = 'rgba(241, 196, 15, 0.9)';
                    icon = '⚠️';
                    break;
                default:
                    backgroundColor = 'rgba(52, 152, 219, 0.9)';
                    icon = 'ℹ️';
            }
            
            messageDiv.style.backgroundColor = backgroundColor;
            messageDiv.innerHTML = `
                <span>${icon}</span>
                <span>${message}</span>
            `;
            
            document.body.appendChild(messageDiv);
            
            // 显示动画
            setTimeout(() => {
                messageDiv.style.opacity = '1';
                messageDiv.style.transform = 'translateY(0)';
            }, 10);
            
            // 3秒后自动隐藏
            setTimeout(() => {
                messageDiv.style.opacity = '0';
                messageDiv.style.transform = 'translateY(-20px)';
                setTimeout(() => {
                    if (messageDiv.parentNode) {
                        messageDiv.remove();
                    }
                }, 300);
            }, 3000);
        }

        // ==================== 工具函数 ====================
        function debounce(func, wait) {
            let timeout;
            return function executedFunction(...args) {
                const later = () => {
                    clearTimeout(timeout);
                    func(...args);
                };
                clearTimeout(timeout);
                timeout = setTimeout(later, wait);
            };
        }

        // 初始化完成
        console.log('🎉 定制歌厅系统初始化完成！');
    </script>
</body>
</html>
